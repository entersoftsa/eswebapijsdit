/*! Entersoft Application Server WEB API - v3.0.9 - 2022-06-16
* Copyright (c) 2022 Entersoft SA; Licensed Apache-2.0 */
!function(a){"use strict";function b(a,b,c){a.isReady=!1,a.doShowForm=!1,b.subscribe("ES_HTTP_CORE_ERR",function(b,d){var e=c.getUserMessage(b,d);a.esnotify.error(e.messageToShow)}),c.getESUISettings().mobile=window.esDeviceMode,c.getESUISettings().defaultGridHeight=window.esGridHeight?window.esGridHeight.toString()+"px":"",c.getESUISettings().mobile&&window.esGridHeight&&window.esGridHeight>80&&(c.getESUISettings().defaultGridHeight=(window.esGridHeight-80).toString()+"px")}function c(b,c,d,e,f){return window.esWebApiToken?void d.validateToken(window.esWebApiToken,b.esCredentials).then(function(d){c.setWebApiToken(window.esWebApiToken),a.isFunction(e)&&e(),b.isReady=!0,b.doShowForm=!1})["catch"](function(a){return kendo.ui.progress(f,!1),b.esCredentials.UserID&&b.esCredentials.Password&&b.esCredentials.BranchID&&b.esCredentials.bridgeId?void b.authenticate():(b.isReady=!1,void(b.doShowForm=!0))}):b.esCredentials.UserID&&b.esCredentials.Password&&b.esCredentials.BranchID&&b.esCredentials.bridgeId?void b.authenticate():(kendo.ui.progress(f,!1),b.isReady=!1,void(b.doShowForm=!0))}var d=a.module("esWebPqApp",["ngStorage","ui.router","es.Services.Web","kendo.directives","underscore","es.Web.UI","ui.bootstrap","pascalprecht.translate"]);d.run(["$anchorScroll","$window",function(a,b){b.ga("create","UA-50505865-23","auto"),window.esGoTo=function(b){b&&a(b)}}]),d.config(["$logProvider","esWebApiProvider","$translateProvider",function(a,b,c){var d=window.esWebApiSettings||{host:"api.entersoft.gr",allowUnsecureConnection:!1};b.setSettings(d),c.useStaticFilesLoader({files:[{prefix:window.ESIsB2B?"/assets/collab/languages/eswebapi-locale-":"languages/eswebapi-locale-",suffix:".json"}]}),c.preferredLanguage("el"),c.fallbackLanguage("en"),c.useSanitizeValueStrategy("escape")}]),d.controller("esComponentCtrl",["$scope","$log","$window","esMessaging","esWebApi","esUIHelper","esGlobals","$translate","$q","esCache","$location",function(d,e,f,g,h,i,j,k,l,m,n){function o(b,c){if(!a.isArray(b))return b.ID.toLowerCase()==c?b:null;for(var d=0;d<b.length;d++){var e=b[d];if(a.isArray(e))for(var f=0;f<e.length;f++){var g=o(e[f],c);if(g)return g}else{if(e.ID.toLowerCase()==c)return e;if(a.isArray(e.esDef)){var h=o(e.esDef,c);if(h)return h}}}return null}function p(a,b){var c=(new j.ESPublicQueryDef).initFromObj(a.esDef);return c.Params=i.createESParams(b.Params),c.CtxID=a.ID,c.Title=b.Title||a.Title,{AA:a.AA,ID:a.ID,Title:b.Title||a.Title,ESUIType:a.ESUIType.toLowerCase(),esDef:c}}var q=a.element(document.querySelector("#esWait"));kendo.ui.progress(q,!0),d.esCredentials={},d.isReady=!1,f.ga("send","pageview",n.path()),f.esWebApiSettings&&(d.esCredentials.subscriptionId=f.esWebApiSettings.subscriptionId||"",d.esCredentials.subscriptionPassword=f.esWebApiSettings.subscriptionPassword||"",d.esCredentials.UserID=f.esWebApiSettings.UserID||"",d.esCredentials.Password=f.esWebApiSettings.Password||"",d.esCredentials.bridgeId=f.esWebApiSettings.bridgeId||"",d.esCredentials.BranchID=f.esWebApiSettings.BranchID||"",d.esCredentials.LangID=f.esWebApiSettings.LangID||"",d.esClaims=f.esWebApiSettings.esClaims||{}),b(d,g,j);var r=f.navigator.language||f.navigator.userLanguage;d.esCredentials.LangID=d.esCredentials.LangID?d.esCredentials.LangID:j.suggestESLanguageID(r),d.esLinkPrefix=f.esLinkPrefix||"",d.authenticate=function(){h.openSession(d.esCredentials,d.esClaims).then(function(a){window.esWebApiToken=j.getWebApiToken(),s(),d.isReady=!0,d.doShowForm=!1},function(a){d.isReady=!1,d.doShowForm=!0,kendo.ui.progress(q,!1);j.getUserMessage(a)})};var s=function(){if(d.esLinkPrefix=window.esLinkPrefix||"",d.esSimpleMode=window.esSimpleMode||!1,"eslink"==window.esDef.ESUIType.toLowerCase()){var b={Title:k.instant("ESUI.FAV.LINK"),ID:"eslink",ESUIType:"esCombo",esDef:[]};return window.esDef.ID&&window.esMainMenu&&a.isArray(window.esMainMenu)&&window.esMainMenu.length?void h.getBodyFromES00Blob(window.esDef.ID).then(function(a){if(a=a.data,a.GID.toLowerCase()==window.esDef.ID.toLowerCase()&&a.TextBody){var c=JSON.parse(a.TextBody),e=o(window.esMainMenu,c.ID.toLowerCase());e&&(b.esDef=[p(e,c)])}d.esPqDef=b,kendo.ui.progress(q,!1)})["catch"](function(a){d.esPqDef=b,kendo.ui.progress(q,!1);var c=j.getUserMessage(a);d.esnotify.error(c.messageToShow)}):(d.esPqDef=b,void kendo.ui.progress(q,!1))}if("esfav"==window.esDef.ESUIType.toLowerCase()){d.isFav=!0;var c=l.defer(),e=m.getItem("ES_USR_FAV");return e?c.resolve(e):h.getBodyFromES00Blob("ESGOUser",j.getClientSession().connectionModel.GID,9e3).then(function(a){var b=new i.ESFavourites(a.data.TextBody);m.setItem("ES_USR_FAV",b),c.resolve(b)})["catch"](function(a){c.reject(a)}),void c.promise.then(function(b){var c;window.esMainMenu&&a.isArray(window.esMainMenu)&&window.esMainMenu.length?(c=_.map(b.shortcuts,function(a){var b=a?o(window.esMainMenu,a.ID):null;return b?p(b,a):null}),_.remove(c,function(a){return!a})):c=[];var e={Title:k.instant("ESUI.FAV.FAVOURITES"),ID:"favourites",ESUIType:"esCombo",esDef:c};d.esPqDef=e,kendo.ui.progress(q,!1)})["catch"](function(a){kendo.ui.progress(q,!1);var b=j.getUserMessage(a);d.esnotify.error(b.messageToShow)})}d.isFav=!1,"escombo"==window.esDef.ESUIType.toLowerCase()?(d.esPqDef=window.esDef,kendo.ui.progress(q,!1)):(d.esPqDef={AA:1,ID:"PQ_1",ESUIType:"esCombo",esDef:[window.esDef]},kendo.ui.progress(q,!1))};c(d,j,h,s,q)}])}(window.angular);