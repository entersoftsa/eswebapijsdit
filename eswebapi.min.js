/*! Entersoft Application Server WEB API - v3.1.1 - 2022-09-01
* Copyright (c) 2022 Entersoft SA; Licensed Apache-2.0 */
!function(){"use strict";function a(a,b){return-1!==a.indexOf(b,a.length-b.length)}function b(a,b){return 0===a.toLowerCase().indexOf(b.toLowerCase())}var c=angular.module("es.Services.Web",["ngStorage"]);c.constant("ESWEBAPI_URL",{__LOGIN__:"api/Login/Login",__VALIDATE_USER__:"api/Login/ValidateUser",__TOKEN__:"api/Login/validateToken",__LOGOUT__:"api/Login/Logout",__CHG_PWD__:"api/Login/ChangePassword",__USER_LOGO__:"api/Login/UserLogo/",__REMOVE_USER_LOGO__:"api/Login/RemoveUserLogo/",__REMOVE_ENTITY_BLOB__:"api/Login/RemoveEntityBlob/",__PERSON_LOGO__:"api/rpc/personLogo/",__POST_USER_LOGO__:"api/Login/UpdateUserLogo/",__POST_ENTITY_BLOB__:"api/Login/UpdateEntityBlob/",__EVENTLOG__:"api/rpc/EventLog/",__PUBLICQUERY__:"api/rpc/PublicQuery/",__MULTI_PULIC_QUERY__:"api/rpc/MultiPublicQuery/",__PUBLICQUERY_INFO__:"api/rpc/PublicQueryInfo/",__USERSITES__:"api/Login/Usersites",__STANDARD_ZOOM__:"api/rpc/FetchStdZoom/",__MULTI_STANDARD_ZOOM__:"api/rpc/MultiFetchStdZoom/",__SCROLLERROOTTABLE__:"api/rpc/SimpleScrollerRootTable/",__SCROLLER__:"api/rpc/SimpleScroller/",__ENTITYACTION__:"api/Entity/",__REGISTERED_ENDPOINT_FOR_TYPE__:"api/endpoint/RegisteredEndpointFor",__ENTITYBYGIDACTION__:"api/EntityByGID/",__ELASTICSEARCH__:"api/esearch/",__SEND_SMS__:"api/collaboration/SendSMS/",__SERVER_CAPABILITIES__:"api/Login/ServerCapabilities/",__FETCH_COMPANY_PARAM__:"api/rpc/FetchCompanyParam/",__GET_PARAMETER_VALUE__:"api/rpc/ParameterValue/",__FETCH_COMPANY_PARAMS__:"api/rpc/FetchCompanyParams/",__SCROLLER_COMMAND__:"api/rpc/ScrollerCommand/",__FORM_COMMAND__:"api/rpc/FormCommand/",__EBS_SERVICE__:"api/rpc/EbsService/",__FETCH_SESSION_INFO__:"api/rpc/FetchSessionInfo/",__FETCH_ODS_TABLE_INFO__:"api/rpc/FetchOdsTableInfo/",__FETCH_ODS_COLUMN_INFO__:"api/rpc/FetchOdsColumnInfo/",__FETCH_ODS_RELATION_INFO__:"api/rpc/FetchOdsRelationInfo/",__FETCH_ODS_DETAIL_RELATIONS_INFO__:"api/rpc/FetchOdsDetailRelationsInfo/",__FETCH_ODS_MASTER_RELATIONS_INFO__:"api/rpc/FetchOdsMasterRelationsInfo/",__FI_IMPORTDOCUMENT___:"api/rpc/FIImportDocument/",__FETCH_ENTITY__:"api/rpc/fetchEntity/",__FETCH_ENTITY_BY_CODE__:"api/rpc/fetchEntityByCode/",__FETCH_ESPROPERTY_SET__:"api/rpc/fetchPropertySet/",__FETCH_ESSCALE__:"api/rpc/fetchESScale/",__FETCH_WEB_EAS_ASSET__:"api/asset/",__DOWNLOAD_WEB_EAS_ASSET__:"api/asset2/downloadAsset/",__FETCH_ES00DOCUMENT_BY_GID__:"api/ES00Documents/InfoByGID/",__FETCH_ES00DOCUMENT_BY_CODE__:"api/ES00Documents/InfoByCode/",__FETCH_ES00DOCUMENT_BY_ENTITYGID__:"api/ES00Documents/InfoByEntityGid/",__FETCH_ES00DOCUMENT_BLOBDATA_BY_GID__:"api/ES00Documents/BlobDataByGID/",__DOWNLOAD_ES00DOCUMENT_BLOBDATA_BY_GID__:"api/ES00Documents/DownloadBlobDataByGID/",__DOWNLOAD_ES00BLOB_BY_GID__:"api/ES00Documents/GetES00Blob/",__DOWNLOAD_ES00BLOB_BY_OBJECT__:"api/ES00Documents/GetES00BlobFromObject/",__FETCH_ES00DOCUMENT_MIME_TYPES__:"api/ES00Documents/ESMimeTypes/",__DELETE_ES00DOCUMENT__:"api/ES00Documents/DeleteES00Document/",__ADD_OR_UPDATE_ES00DOCUMENT_BLOBDATA__:"api/ES00Documents/AddOrUpdateES00DocumentBlobData/",__EXPORT_PROXY_SAVEFILE__:"api/export/savefile/",__FETCH_ES00DEVICE__:"api/device/fetchDevice/",__GET_BODY_FROM_ES00BLOB__:"api/ES00Documents/GetBodyFromES00Blob/",__POST_BODY_TO_ES00BLOB__:"api/ES00Documents/PostBodyToES00Blob/"}),c.value("__WEBAPI_RT__",{url:""}),c.provider("esWebApi",function(){var c="",d="",e="",f={},g={host:"",allowUnsecureConnection:!1,subscriptionId:"",subscriptionPassword:"",bridgeId:"",additionalHeaders:{}};return{getSettings:function(){return g},getServerUrl:function(){return c},setSettings:function(h){var i="https://",j="http://";if(g=h,!g.host)throw new Error("host for Entersoft WEB API Server is not specified");if(g.host=g.host.trim(),b(g.host,i)?g.host=g.host.slice(i.length).trim():b(g.host,j)&&(g.host=g.host.slice(j.length).trim()),""==g.host)throw new Error("host for Entersoft WEB API Server is not specified");return a(g.host,"/")||(g.host+="/"),d=j+g.host,e=i+g.host,f=g.additionalHeaders,c=g.allowUnsecureConnection?d:e,this},$get:["$http","$log","$q","$timeout","$rootScope","$injector","ESWEBAPI_URL","esGlobals","esMessaging","esCache",function(a,b,d,h,i,j,k,l,m,n){function o(a){var b=a||{Authorization:l.getWebApiToken()};return angular.extend(b,f),b}function p(a,d){if(a){var e=angular.copy(a);try{$.ajax({type:"POST",url:c.concat(k.__EVENTLOG__),contentType:"application/json",headers:o(),data:JSON.stringify({exceptionData:e,exceptionStore:d},null,"	")})}catch(f){b.warn("Error logging failed"),b.error(f)}}}function q(){var b=d.defer(),e=n.getItem("ES_MIME_TYPES");if(e)return h(function(){b.resolve(e)}),b.promise;var f=c.concat(k.__FETCH_ES00DOCUMENT_MIME_TYPES__),g={method:"GET",headers:o(),url:f},i=a(g);return v(i).then(function(a){n.setItem("ES_MIME_TYPES",a.data),b.resolve(a.data)},function(){b.reject(arguments)}),b.promise}function r(b){if(!b||!b.ScrollerID||!b.CommandID)throw new Error("ScrollerID and CommandID properties must be defined");var e=c.concat(k.__SCROLLER_COMMAND__);if(window.ESIsB2B&&(b=b||{},b.TAGID=b.TAGID||window.TAGID,!b.TAGID)){var f=d.defer();return f.reject(new Error("Trying to execute Scroller Command ["+b.ScrollerID+"/"+b.CommandID+"] with no parameter TAGID set is forbidden.")),v(f.promise)}var g=a({method:"post",headers:o(),url:e,data:b});return g}function s(b,e){var f=c+k[b]+e,g=d.defer(),i=n.getItem(f);if(i)return h(function(){g.resolve(i)}),g.promise;var j=a({method:"get",headers:o(),url:f});return v(j).then(function(a){n.setItem(f,a),g.resolve(a)},function(){g.reject(arguments)}),g.promise}function t(b){if(!b||!b.EntityID||!b.CommandID)throw new Error("EntityID and CommandID properties must be defined");var e=c+k.__FORM_COMMAND__;if(window.ESIsB2B&&(b=b||{},b.TAGID=b.TAGID||window.TAGID,!b.TAGID)){var f=d.defer();return f.reject(new Error("Trying to execute form command ["+b.EntityID+"/"+b.CommandID+"] with no parameter TAGID set is forbidden.")),v(f.promise)}var g=a({method:"post",headers:o(),url:e,data:b});return v(g)}function u(b,e,f,g){if(e=e?e.trim():"",f=f?f.trim():"",window.ESIsB2B&&(g=g||{},g.TAGID=g.TAGID||window.TAGID,!g.TAGID)){var h=d.defer();return h.reject(new Error("Trying to execute Scroller ["+e+"/"+f+"] with no parameter TAGID set is forbidden.")),v(h.promise)}var i=c.concat(b,e,"/",f),j=a({method:"GET",headers:o(),url:i,params:g});return v(j)}function v(a,c){if(!a)throw new Error("processWEBAPIToken can have parameter promise null or undefined");var d=function(a){var b;return a&&angular.isFunction(a.headers)&&(b=a.headers(),b&&b["x-es-refresh-token"]&&l.setWebApiToken(b["x-es-refresh-token"],a.config.url||"-")),a},e=function(a){throw d(a),a};return a=a.then(d)["catch"](e),a=a["catch"](function(a){var d=a.data||a;throw d?b.error(d):console.log("Generic Http error"),c||m.publish("ES_HTTP_CORE_ERR",d,a.status),a})}return{getServerUrl:function(){return c},getServerSettings:function(){return g},openSession:function(b,d){var e={SubscriptionID:b.subscriptionId||g.subscriptionId,SubscriptionPassword:b.subscriptionPassword||g.subscriptionPassword,BridgeID:b.bridgeId||g.bridgeId,ExtraPin:b.extraPin,Model:b,Claims:d||g.claims,IsExternal:b.IsExternal};b.StickySession&&(e.SessionSpec="*");var f=a({method:"post",url:c+k.__LOGIN__,headers:o({}),data:e}).then(function(a){return l.sessionOpened(a.data,b),a})["catch"](function(a){throw l.sessionClosed(),a});return v(f)},validateUser:function(b){if(!b)throw new Error("Parameter token cannot be empty");var d=a({method:"post",url:c+k.__VALIDATE_USER__,headers:o(),data:b}).then(function(a){return a})["catch"](function(a){throw a});return v(d)},validateToken:function(b,d){if(!b)throw new Error("Parameter token cannot be empty");var e=a({method:"post",url:c+k.__TOKEN__,headers:o({}),data:{webapitoken:b.startsWith("Bearer ")?b:"Bearer "+b}}).then(function(a){return l.sessionOpened(a.data,d),a})["catch"](function(a){throw l.sessionClosed(),a});return v(e)},eventLog:function(b){if(!b)throw new Error("esLog parameter cannot be empty");var d=a({method:"post",headers:o(),url:c+k.__EVENTLOG__,data:JSON.stringify(b)});return v(d)},ebsService:function(b,d){if(!(b&&b.netAssembly&&b.netNamespace&&b.netClass&&b.netMethod))throw new Error("serviceObj.netAssembly, serviceObj.netNamespace, serviceObj.netClass, serviceObj.netMethod properties MUST ALL have value");var e=b.netAssembly.concat("/",b.netNamespace,"/",b.netClass,"/",b.netMethod),f=d,g={method:"post",headers:o(),url:c.concat(k.__EBS_SERVICE__,e),data:f};b.netIsBinaryResult?(g.headers.Accept=void 0,g.responseType="arraybuffer"):g.contentType="application/json; charset=utf-8";var h=a(g);return v(h)},fetchUserLogo:function(b){var d=a({method:"get",headers:o(),url:c.concat(k.__USER_LOGO__,b||"")});return v(d)},uploadEntityBlob:function(a,b,d,e,f){if(!a||!a.ObjectID||!a.KeyID)throw new Error("blobInfo argument is null or one or more of the required properties [ObjectID, KeyID] are missing");if(!b)throw new Error("Invalid File");var g=j.get("Upload");if(!g)throw new Error("You have to include the ngFileUpload");return a.TypeID=a.TypeID||0,b.upload=g.upload({url:c.concat(k.__POST_ENTITY_BLOB__),method:"POST",headers:o(),fields:{esblobinfo:JSON.stringify(a)},file:b}),b.upload.then(function(a){h(function(){b.result=a.data,angular.isFunction(d)&&d(b)})},e),b.upload.progress(f),b.upload},uploadUserLogo:function(a,b,d,e){if(!a)throw new Error("Invalid File");var f=j.get("Upload");if(!f)throw new Error("You have to include the ngFileUpload");return a.upload=f.upload({url:c.concat(k.__POST_USER_LOGO__),method:"POST",headers:o(),file:a}),a.upload.then(function(c){h(function(){a.result=c.data,angular.isFunction(b)&&b(a)})},d),a.upload.progress(e),a.upload},removeEntityBlob:function(b){var d=b&&(b.GID||b.ObjectID&&b.KeyID);if(!d)throw new Error("blobInfo argument is null or one or more of the required properties [GID or (ObjectID and KeyID)] are missing");b.TypeID=b.TypeID||0;var e=a({method:"POST",headers:o(),url:c.concat(k.__REMOVE_ENTITY_BLOB__),data:b});return v(e)},removeCurrentUserLogo:function(){var b=a({method:"POST",headers:o(),url:c.concat(k.__REMOVE_USER_LOGO__)});return v(b)},fetchPersonLogo:function(b){if(!b)throw new Error("Invalid personGID");var d=a({method:"get",headers:o(),url:c.concat(k.__PERSON_LOGO__,b)});return v(d)},logout:function(){var b=o();l.sessionClosed(),n.clear();var d=a({method:"post",headers:b,url:c.concat(k.__LOGOUT__)});return d["catch"](function(a){})},changePassword:function(b){if(!(b&&b.OldPassword&&b.NewPassword&&b.NewPassword2))throw new Error("Invalid Arguments. Either Old Password, or New Password or Verify Password is empty");var d=o(),e=a({method:"post",headers:d,url:c.concat(k.__CHG_PWD__),data:b});return e.then(function(a){l.sessionClosed(),n.clear()})},fetchCompanyParam:function(b){if(!b)throw new Error("Invalid Paramter ID");var d=c.concat(k.__FETCH_COMPANY_PARAM__,b.replace(" ","")),e=a({method:"get",headers:o(),url:d});return v(e)},getParameterValue:function(b){if(!b)throw new Error("Invalid Paramter ID");var d=c.concat(k.__GET_PARAMETER_VALUE__,b.replace(" ","")),e=a({method:"get",headers:o(),url:d});return v(e,!0)},fetchCompanyParams:function(b,d){var e;e=b?angular.isArray(b)?c+k.__FETCH_COMPANY_PARAMS__+b.join("/").replace(/ /g,""):c+k.__FETCH_COMPANY_PARAMS__+b.replace(/,/g,"/").replace(/ /g,""):c+k.__FETCH_COMPANY_PARAMS__;var f=a({method:"get",headers:o(),url:e});return v(f,d)},execHttp:function(b){if(!b)return null;var c=a(b);return c},registerException:p,fetchOdsTableInfo:function(a){return a=a?a.trim():"",s("__FETCH_ODS_TABLE_INFO__",a)},fetchOdsColumnInfo:function(a,b){a=a?a.trim():"",b=b?b.trim():"";var c="";if(b)c=a+"/"+b;else{var d=a.split(".");c=2==d.length?d[0]+"/"+d[1]:a}return s("__FETCH_ODS_COLUMN_INFO__",c)},fetchOdsRelationInfo:function(a){return a=a?a.trim():"",s("__FETCH_ODS_RELATION_INFO__",a)},fetchOdsMasterRelationsInfo:function(a,b){return a=a?a.trim():"",b=b?b.trim():"",s("__FETCH_ODS_MASTER_RELATIONS_INFO__",a+"/"+b)},fetchOdsDetailRelationsInfo:function(a,b){return a=a?a.trim():"",b=b?b.trim():"",s("__FETCH_ODS_DETAIL_RELATIONS_INFO__",a+"/"+b)},fetchServerCapabilities:function(){var b=d.defer();return a.get(e+k.__SERVER_CAPABILITIES__).then(function(a){b.resolve(a.data)},function(a){b.reject([a.data,a.status,a.headers,a.config])}),b.promise},fetchScroller:function(a,b,c){return u(k.__SCROLLER__,a,b,c)},fetchSimpleScrollerRootTable:function(a,b,c){return u(k.__SCROLLERROOTTABLE__,a,b,c)},fetchUserSites:function(b,d){d=d||{};var e=a({method:"post",url:c+k.__USERSITES__,data:{SubscriptionID:d.subscriptionId||g.subscriptionId,SubscriptionPassword:d.subscriptionPassword||g.subscriptionPassword,BridgeID:d.bridgeId||g.bridgeId,Model:b}});return v(e)},fetchSessionInfo:function(){var b=a({method:"get",headers:o(),url:c+k.__FETCH_SESSION_INFO__});return v(b)},registeredEndpointForType:function(b){var d=a({method:"post",headers:o(),params:{EndpointType:b},url:c+k.__REGISTERED_ENDPOINT_FOR_TYPE__});return v(d)},executeNewEntityAction:function(b,d,e){var f=c.concat(k.__ENTITYACTION__,b,"/",d),g=a({method:"post",headers:o(),url:f,data:e});return v(g)},executeEntityActionByCode:function(b,d,e,f){var g=c.concat(k.__ENTITYACTION__,b,"/",d,"/",e),h=a({method:"post",headers:o(),url:g,data:f});return v(h)},executeEntityActionByGID:function(b,d,e,f){var g=c.concat(k.__ENTITYBYGIDACTION__,b,"/",d,"/",e),h=a({method:"post",headers:o(),url:g,data:f});return v(h)},executeFormCommand:function(a){return t(a)},executeFormCommandDS:function(a,b,c,d){var e={EntityID:a,CommandID:b,CommandParams:c};return d&&(e.EntityDataset=d),t(e)},executeScrollerCommandSRV:function(a,b,c,d,e){var f={ScrollerID:a+"/"+b,CommandID:c,ScrollerParams:d,CommandParams:e};return r(f)},executeScrollerCommandDS:function(a,b,c,d,e){var f={ScrollerID:a+"/"+b,CommandID:c,ScrollerDataset:d,CommandParams:e};return r(f)},fetchPublicQueryInfo:function(b,e,f,g){var i="";b instanceof l.ESPublicQueryDef?(i=(b.GroupID||"").trim(),e=(b.FilterID||"").trim()):(i=b?b.trim():"",e=e?e.trim():"");var j=c.concat(k.__PUBLICQUERY_INFO__,i,"/",e),m=d.defer();if(f){var p=n.getItem(j);if(p)return h(function(){m.resolve(p)}),m.promise}var q=a({method:"get",headers:o(),url:j});return v(q).then(function(a){f&&n.setItem(j,a),m.resolve(a)},function(){m.reject(arguments)}),m.promise},fetchStdZoom:function(b,e,f){b=b?b.trim():"",f=!e&&f;var g=d.defer();if(f){var i=n.getItem("ESZOOM_"+b);if(i)return h(function(){g.resolve(i)}),g.promise}var j=c.concat(k.__STANDARD_ZOOM__,b),m=a({method:"get",headers:o({Authorization:l.getWebApiToken(),"X-ESPQOptions":JSON.stringify(e)}),url:j}),p=v(m);return p.then(function(a){f&&n.setItem("ESZOOM_"+b,a),g.resolve(a)},function(){g.reject(arguments)}),g.promise},fetchMultiStdZoom:function(b){var e=d.defer(),f=[];b=b||[];var g=_.filter(b,function(a){return a.UseCache&&n.getItem("ESZOOM_"+a.ZoomID)?!1:!0});if(0==g.length)return h(function(){var a;for(a=0;a<b.length;a++)f.push(n.getItem("ESZOOM_"+b[a].ZoomID));e.resolve(f)}),e.promise;var i=c.concat(k.__MULTI_STANDARD_ZOOM__),j=a({method:"POST",headers:o(),data:g,url:i}),l=v(j);return l.then(function(a){var c=0;_.each(b,function(b){if(b.UseCache&&n.getItem("ESZOOM_"+b.ZoomID))f.push(n.getItem("ESZOOM_"+b.ZoomID));else{var d=a[c];c+=1,b.UseCache&&n.setItem("ESZOOM_"+b.ZoomID,d),f.push(d)}}),e.resolve(f)},function(){e.reject(arguments)}),e.promise},fetchPublicQuery:function(b,e,f,g,h){var i,j;if(b instanceof l.ESPublicQueryDef?(i=(b.GroupID||"").trim(),e=(b.FilterID||"").trim(),f=b.PQOptions,j=b.Params):(i=b?b.trim():"",e=e?e.trim():"",j=g),j&&j instanceof l.ESParamValues&&(j=j.getExecuteVals()),window.ESIsB2B&&(j=j||{},j.TAGID=j.TAGID||window.TAGID,!j.TAGID)){var m=d.defer();return m.reject(new Error("Trying to execute a PQ with no TAGID parameter in PQ ["+b+"/"+e+"] is forbidden")),v(m.promise)}var n=c.concat(k.__PUBLICQUERY__,i,"/",e),p={headers:o(),url:n,params:j};f&&(p.headers["X-ESPQOptions"]=JSON.stringify(f)),p.method=h||"POST","GET"!==p.method&&(delete p.params,p.data=j);var q=a(p);return v(q)},multiPublicQuery:function(b){var d=c.concat(k.__MULTI_PULIC_QUERY__),e={headers:o(),url:d,method:"POST"};e.data=b;var f=a(e);return v(f)},fetchEASWebAsset:function(b,d,e){var f={base64:!1};d?(f.base64=!!d.base64,f.responseType=d.responseType,f.Accept=d.Accept,f.esonly=d.esonly||!1):(f.responseType="arraybuffer",f.esonly=!1);var g=c.concat(k.__FETCH_WEB_EAS_ASSET__),h={method:"GET",headers:o(),url:g,params:{routeId:b,base64:f.base64,esonly:f.esonly}};h.headers.Accept=f.Accept,f.responseType&&(h.responseType=f.responseType);var i=a(h);return v(i,e)},fetchEntity:function(b,d){if(!b||!d)throw new Error("Invalid parameters");var e=c.concat(k.__FETCH_ENTITY__,b,"/",d),f=a({method:"get",headers:o(),url:e});return v(f)},fetchEntityByCode:function(b,d){if(!b||!d)throw new Error("Invalid parameters");var e=c.concat(k.__FETCH_ENTITY_BY_CODE__,b,"/",d),f=a({method:"get",headers:o(),url:e});return v(f)},fetchPropertySet:function(b,d){if(!b)throw new Error("Invalid parameter");d&&(b=b+"/"+d);var e=c.concat(k.__FETCH_ESPROPERTY_SET__,b),f=a({method:"get",headers:o(),url:e});return v(f)},fetchESScale:function(b){var e=d.defer();if(!b)return e.reject("Invalid parameter"),e.promise;b=b.toLowerCase();var f=n.getItem("ESGOSCALE_"+b);if(f)return h(function(){e.resolve(f)}),e.promise;var g=c.concat(k.__FETCH_ESSCALE__,b),i=a({method:"get",headers:o(),url:g});return v(i,!0).then(function(a){n.setItem("ESGOSCALE_"+b,a.data),e.resolve(a.data)},function(){e.reject(arguments)}),e.promise},fiImportDocument:function(b){if(!b)throw new Error("xmldocstr is not a valid string");var d=c.concat(k.__FI_IMPORTDOCUMENT___),e=a({method:"post",headers:o(),url:d,data:b});return v(e)},downloadURLForBlobDataDownload:function(a){if(!a)return"";var b=c.concat(k.__DOWNLOAD_ES00DOCUMENT_BLOBDATA_BY_GID__,a);return b+="?webapitoken="+l.getWebApiToken()},userLogoUrl:function(a){var b=c.concat(k.__USER_LOGO__,a);return b+="?webapitoken="+l.getWebApiToken(),b+="&base64=false"},downloadES00BlobURLByGID:function(b,d,e){if(!b)return"";var f=c.concat(k.__DOWNLOAD_ES00BLOB_BY_GID__,b);if(f+="?webapitoken="+l.getWebApiToken(),d&&(f+="&extType="+d),!e)return f;var g=a({method:"get",headers:o(),url:f});return v(g,!0)},downloadES00BlobURLByObject:function(b,d,e,f,g,h){if(!b||!d||null==e||void 0==e)return"";var i=c.concat(k.__DOWNLOAD_ES00BLOB_BY_OBJECT__,b);if(i+="?keyid="+d,i+="&typeid="+e,i+="&webapitoken="+l.getWebApiToken(),f&&(i+="&extType="+f),g&&(i+="&ts="+Number(new Date)),!h)return i;var j=a({method:"get",headers:o(),url:i});return v(j,!0)},getBodyFromES00Blob:function(b,d,e){if(!b)throw new Error("invalid parameters");var f=c.concat(k.__GET_BODY_FROM_ES00BLOB__,b);d&&e&&(f+="?keyid="+d,f+="&typeid="+e);var g=a({method:"get",headers:o(),url:f});return v(g)},postBodyToES00Blob:function(b){if(!b||!b.ObjectID||!b.KeyID||null==b.TypeID||void 0==b.TypeID)throw new Error("invalid parameters");var d=c.concat(k.__POST_BODY_TO_ES00BLOB__),e=a({method:"post",headers:o(),url:d,data:b});return v(e)},downloadES00BlobByGID:function(b,d){if(!b)throw new Error("Invalid parameter es00documentGID");var e=c.concat(k.__DOWNLOAD_ES00BLOB_BY_GID__,b);d&&(e+="?extType="+d);var f={method:"GET",headers:o({Authorization:l.getWebApiToken(),Accept:void 0}),url:e,responseType:"arraybuffer"},g=a(f);return v(g)},downloadAssetURL:function(a){var b=c.concat(k.__DOWNLOAD_WEB_EAS_ASSET__,a);return b+="?base64=false&webapitoken="+l.getWebApiToken()},fetchES00DocumentBlobDataByGID:function(b){var d=c.concat(k.__FETCH_ES00DOCUMENT_BLOBDATA_BY_GID__,b),e={method:"GET",headers:o({Authorization:l.getWebApiToken(),Accept:void 0}),url:d,responseType:"arraybuffer"},f=a(e);return v(f)},getMimeTypes:q,fetchES00DocumentByGID:function(b){b=b?b.trim():"";var d=c.concat(k.__FETCH_ES00DOCUMENT_BY_GID__,b),e=a({method:"get",headers:o(),url:d});return v(e)},fetchES00DocumentByCode:function(b){b=b?b.trim():"";var d=c.concat(k.__FETCH_ES00DOCUMENT_BY_CODE__,b),e=a({method:"get",headers:o(),url:d});return v(e)},fetchES00DocumentsByEntityGID:function(b){b=b?b.trim():"";var d=c.concat(k.__FETCH_ES00DOCUMENT_BY_ENTITYGID__,b),e=a({method:"get",headers:o(),url:d});return v(e)},deleteES00Document:function(b){if(b=b||{},!(b.TableID&&b.TableName&&b.GID&&b.fGID))throw new Error("Invalid parameter. One or more of the properties TableID, TableName, fGID and GID are not specified");var d=c.concat(k.__DELETE_ES00DOCUMENT__),e=a({method:"post",headers:o(),url:d,data:b});return v(e)},proxyExportSaveFile:function(a){var b=c.concat(k.__EXPORT_PROXY_SAVEFILE__);return b+="?webapitoken="+l.getWebApiToken(),a&&(b+="&proxyType="+a),b},addOrUpdateES00Document:function(a,b,d,e,f){if(!b)throw new Error("Invalid File");var g=j.get("Upload");if(!g)throw new Error("You have to include the ngFileUpload");return b.upload=g.upload({url:c.concat(k.__ADD_OR_UPDATE_ES00DOCUMENT_BLOBDATA__),method:"POST",headers:o(),fields:{esdoc:JSON.stringify(a)},file:b}),b.upload.then(function(a){h(function(){b.result=a.data,d(b)})},e),b.upload.progress(f),b.upload},sendSMS:function(b){if(!b||!b.Body||0==(b.Recipients||[]).length)throw new Error("Invalid smsObject");var d=c.concat(k.__SEND_SMS__),e=a({method:"post",headers:o(),url:d,data:b});return v(e)},fetchDeviceInfo:function(b){if(!b)throw new Error("Invalid deviceCode");var d=c.concat(k.__FETCH_ES00DEVICE__,b),e=a({method:"get",headers:o(),url:d});return v(e)}}}]}})}(),function(){"use strict";var underscore=angular.module("underscore",[]);underscore.factory("_",function(){return window._});var version="3.1.1",vParts=_.map(version.split("."),function(a){return parseInt(a)}),esAngularAPIVer={Major:vParts[0],Minor:vParts[1],Patch:vParts[2]},esUISettings={mobile:void 0},esWebFramework=angular.module("es.Services.Web");esWebFramework.provider("esCache",function(){var a=null,b={capacity:Number.MAX_VALUE,storageMode:"memory"};return{setCapacity:function(a){angular.isNumber(a)?b.capacity=a:b.capacity=Number.MAX_VALUE},getCapacity:function(){return b.capacity},getSettings:function(){return b},setStorageSettings:function(a){b&&(b.storageMode=a||"memory")},$get:["$cacheFactory",function(c){return a=c("esCache",b),{getItem:function(b){return a.get(b)},setItem:function(b,c,d){a.put(b,c)},removeItem:function(b){a.remove(b)},clear:function(){a.removeAll()},stats:function(){return a.info()}}}]}}),esWebFramework.factory("esMessaging",function(){function a(){if(!arguments||arguments.Length<1)throw"Publishing events requires at least one argument for topic id";var a=arguments[0],b=Array.prototype.slice.call(arguments,1);d[a]&&angular.forEach(d[a],function(c){try{c.apply(null,b)}catch(d){console.log("Error in messaging handler for topic ",a)}})}function b(a,b){return d[a]||(d[a]=[]),d[a].push(b),[a,b]}function c(a){var b=a[0];d[b]&&angular.forEach(d[b],function(c){c==a[1]&&d[b].splice(c,1)})}var d={},e={publish:a,subscribe:b,unsubscribe:c};return e}),esWebFramework.factory("esGeoLocationSrv",["$q","$window",function(a,b){function c(){var c=a.defer();return b.navigator.geolocation?b.navigator.geolocation.getCurrentPosition(function(a){c.resolve(a)},function(a){c.reject(a)}):c.reject("Geolocation not supported."),c.promise}return{getCurrentPosition:c}}]),esWebFramework.factory("esGlobals",["$translate","$rootScope","$sessionStorage","$log","esMessaging","esCache","$injector",function($translate,$rootScope,$sessionStorage,$log,esMessaging,esCache,$injector){function fGetesDateRangeOptions(a){if(!a||!dDateRangeClass[a])return esDateRangeOptions;var b=dDateRangeClass[a];if(!_.isArray(b)||0==b.length)return esDateRangeOptions;var c,d=[];for(c=0;c<b.length;c++)d[c]=esDateRangeOptions[b[c]];return d}function suggestESLanguageID(a){if(!a)return"en-US";var b=a.split("-")[0];if(!b)return"es-US";b=b.toLowerCase();var c=_.find(_esSupportedLanguages,function(a){return b==a.id.split("-")[0].toLowerCase()});return c?c.id:"en-US"}function esConvertGIDtoId(a){return a?"gid"+a.replace(/-/g,"_"):"gid"}function esConvertIDtoGID(a){return a?"gid"!=a.slice(0,"gid".length)?a:a.slice(3).replace(/_/g,"-"):""}function ESPropertySet(a){this.ps=a}function componentToHex(a){var b=a.toString(16);return 1==b.length?"0"+b:b}function rgbToHex(a){var b=(16711680&a)>>16,c=(65280&a)>>8,d=255&a;return"#"+componentToHex(b)+componentToHex(c)+componentToHex(d)}function ESPublicQueryDef(a,b,c,d,e,f,g){this.CtxID=a,this.GroupID=b,this.FilterID=c,this.PQOptions=d,this.Params=e,this.UIOptions=f,this.Title=void 0,angular.isUndefined(g)?this.esPanelOpen={status:!1}:angular.isObject(g)?this.esPanelOpen=g:this.esPanelOpen={status:!!g},this.initFromObj=function(a){var b=a||{};this.CtxID=b.CtxID,this.GroupID=b.GroupID,this.FilterID=b.FilterID,this.PQOptions=(new ESPQOptions).initFromObj(b.PQOptions),this.Params=b.Params,this.Title=b.Title,angular.isUndefined(b.esPanelOpen)?this.esPanelOpen={status:!1}:angular.isObject(b.esPanelOpen)?this.esPanelOpen=b.esPanelOpen:this.esPanelOpen={status:!!b.esPanelOpen},this.UIOptions=angular.merge({},b.UIOptions);for(var c in a)this.hasOwnProperty(c)||(this[c]=a[c]);return this}}function ESMultiZoomDef(a,b,c){this.ZoomID=a,this.PQOptions=b,this.UseCache=!!c}function ESPQOptions(a,b,c,d,e){this.Page=a||-1,this.PageSize=b||-1,this.WithCount=!!c,this.ServerPaging=angular.isUndefined(d)||null==d?!0:d,this.AutoExecute=!!e,this.getPageSizeForServer=function(){return this.ServerPaging?this.PageSize:-1},this.getPageSizeForUI=function(){return this.PageSize<1?20:this.PageSize},this.initFromObj=function(a){var b=a||{};return this.Page=b.Page||-1,this.PageSize=b.PageSize||-1,this.WithCount=!!b.WithCount,this.ServerPaging=angular.isUndefined(b.ServerPaging)||null==b.ServerPaging?!0:b.ServerPaging,this.AutoExecute=!!b.AutoExecute,this}}function ESParamVal(a,b,c){this.paramCode=a,this.paramValue=b,this.enumList=c,this.mandatory=!1}function ESBoolParamVal(a,b){ESParamVal.call(this,a,b)}function ESNumericParamVal(a,b){ESParamVal.call(this,a,b)}function ESStringParamVal(a,b){ESParamVal.call(this,a,b)}function ESDateRange(a,b,c,d){return{fromType:a,fromD:b,toType:c,toD:d}}function dateEval(pInfo,expr){function isActualDate(a){return a&&"1753/01/01"!=a&&"9999/01/01"!=a}var SpecificDate="SpecificDate",Month="Month",SixMonth="SixMonth",Week="Week",Year="Year",Quarter="Quarter",Day="Day",FiscalPeriod="FiscalPeriod",FiscalYear="FiscalYear",Bimonthly="Bimonthly";"ESDateRange(Day,0)"==expr&&(expr="ESDateRange(Day)");var dVal=eval(expr.replace(/#/g,'"')),esdate=new ESDateParamVal(pInfo.id),mD=moment(dVal,"YYYY/MM/DD");if(!dVal.fromType&&!dVal.toType&&!dVal.fromD&&!dVal.toD&&mD.isValid())return esdate.paramValue.dRange="1",esdate.paramValue.fromD=mD.toDate(),esdate;if(dVal.fromType==SpecificDate&&isActualDate(dVal.fromD)&&dVal.toType==SpecificDate&&isActualDate(dVal.toD))return esdate.paramValue.dRange="0",esdate.paramValue.fromD=new Date(dVal.fromD),esdate.paramValue.toD=new Date(dVal.toD),esdate;if(dVal.fromType==SpecificDate&&isActualDate(dVal.fromD))return esdate.paramValue.dRange="1",esdate.paramValue.fromD=new Date(dVal.fromD),esdate;var drOptions=fGetesDateRangeOptions(),elem=_.find(drOptions,function(a){return a.dValue==expr});if(!angular.isUndefined(elem))return esdate.paramValue.dRange=expr,esdate;var fD=calcActualDate(dVal.fromType,dVal.fromD,!0),tD=calcActualDate(dVal.toType||dVal.fromType,angular.isUndefined(dVal.toD)?dVal.fromD:dVal.toD,!1);return esdate.paramValue.dRange="0",esdate.paramValue.fromD=fD,esdate.paramValue.toD=tD,esdate}function calcActualDate(a,b,c){switch(a){case"Year":return c?(b>0&&(b-=1),moment().add(b,"years").startOf("year").toDate()):moment().add(b,"years").endOf("year").toDate();case"Month":return c?moment().startOf("month").add(b,"months").toDate():moment().endOf("month").add(b,"months").toDate();case"Week":return c?moment().startOf("week").add(1,"days").add(b,"weeks").toDate():moment().endOf("week").add(1,"days").add(b,"weeks").toDate();case"Day":return moment().add(b,"days").toDate();case"Quarter":return c?(b>0&&(b-=1),moment().startOf("quarter").add(b,"quarters").toDate()):moment().endOf("quarter").add(b,"quarters").endOf("quarter").toDate();case"SixMonth":return calcActualDate("Quarter",c?2*b:2*b+1,c);default:return alert("ESDateRange option NOT Supported. ["+a+", "+b+", "+c+"]. Using Current Month instead"),c?moment().startOf("month").toDate():moment().endOf("month").toDate()}}function ESDateParamVal(a,b){b?angular.isString(b)&&(b=dateEval({id:a},b).pValue()):b={dRange:"ESDateRange(SpecificDate, #9999/01/01#, SpecificDate, #1753/01/01#)",fromD:null,toD:null},ESParamVal.call(this,a,b)}function ESParamValues(a){this.setParamValues(a)}function fgetModel(){if(!esClientSession.connectionModel){var a=$sessionStorage,b=null;"undefined"!=typeof a.__esrequest_sesssion&&null!==a.__esrequest_sesssion?(b=a.__esrequest_sesssion,esClientSession.connectionModel=b,esMessaging.publish("AUTH_CHANGED",esClientSession,getAuthToken(b)),$log.info("RELOGIN User ",esClientSession.connectionModel.Name)):(esMessaging.publish("AUTH_CHANGED",null,getAuthToken(null)),$log.info("NO RELOGIN from stored state"))}return esClientSession.connectionModel}function fsetModel(a){var b=null;esClientSession.connectionModel&&(b=esClientSession.connectionModel.GID),esClientSession.connectionModel=a,a?$sessionStorage.__esrequest_sesssion=a:delete $sessionStorage.__esrequest_sesssion,esMessaging.publish("AUTH_CHANGED",esClientSession,getAuthToken(a))}function getUserMessage(a,b){var c={isLogin:!1,messageToShow:""};if(a&&!_.isString(a)&&_.isArrayLike(a)&&(a=a[0]),!a){switch(b){case 401:c.isLogin=!0,c.messageToShow=$translate.instant("ERR_401");break;case 403:c.isLogin=!0,c.messageToShow=$translate.instant("ERR_403");break;case 500:default:c.isLogin=!0,c.messageToShow=$translate.instant("ERR_500")}return c}if(a instanceof ArrayBuffer)try{a=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(a)))}catch(d){}if(c.isLogin=401==a.status||403==a.status||401==b||403==b,a.data&&a.data instanceof ArrayBuffer)try{a.data=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(a.data)))}catch(d){}var e="";if(a=a.data||a,a.UserMessage){if(e=a.UserMessage,a.MessageID){var f="ERR_"+a.MessageID,g=$translate.instant(f);e=g!=f?g:e+" ("+a.MessageID+")"}c.messageToShow=e}if(a.Messages){if(angular.isArray(a.Messages)){var h=0;e=_.reduce(a.Messages,function(a,b){return a+"\r\n["+ ++h+"] "+b},"")}else e=a.Messages;return c.messageToShow=c.messageToShow?c.messageToShow+"\r\n":c.messageToShow,e?c.messageToShow+=e:c.messageToShow||(c.messageToShow=$translate.instant("ERR_GENERAL")),c}return c.messageToShow=c.messageToShow||a.Message||a.toString(),c}function getAuthToken(a){return a?"Bearer "+a.WebApiToken:""}function getMimeTypes(){return mimes}function requiredEBSVersion(a,b){if(!b)return!0;if(!a)return!1;a=a.replace(" - ",".");var c=_.map(a.split("."),function(a){return parseInt(a.trim())}),d=_.map(b.split("."),function(a){return parseInt(a.trim())});if(c.length!=d.length&&4!=d.length)return!1;var e;for(e=0;4>e;e++){if(c[e]<d[e])return!1;if(c[e]>d[e])return!0}return!0}var esDateRangeOptions=[],esComplexParamFunctionOptions=[],esYesNoTrans=[],esOperTrans=[];$rootScope.$on("$translateChangeSuccess",function(){esYesNoTrans=$translate.instant(["ESUI.BOOLEAN.YES","ESUI.BOOLEAN.NO"]),esOperTrans=$translate.instant(["ESCOMPLEX.EQ","ESCOMPLEX.NE","ESCOMPLEX.LT","ESCOMPLEX.LE","ESCOMPLEX.GT","ESCOMPLEX.GE","ESCOMPLEX.RANGE","ESCOMPLEX.NULL","ESCOMPLEX.NOTNULL","ESCOMPLEX.FROM","ESCOMPLEX.TO","ESDATE_RANGE.SDR","ESDATE_RANGE.SD","ESDATE_RANGE.ANY","ESDATE_RANGE.TODAY","ESDATE_RANGE.UTD","ESDATE_RANGE.SFTD","ESDATE_RANGE.YTD","ESDATE_RANGE.UTYD","ESDATE_RANGE.TMR","ESDATE_RANGE.SFTR","ESDATE_RANGE.CW","ESDATE_RANGE.PW","ESDATE_RANGE.NW","ESDATE_RANGE.CM","ESDATE_RANGE.PM","ESDATE_RANGE.NM","ESDATE_RANGE.SFM","ESDATE_RANGE.UEM","ESDATE_RANGE.SFLM","ESDATE_RANGE.UELM","ESDATE_RANGE.CQ","ESDATE_RANGE.PQ","ESDATE_RANGE.CSM","ESDATE_RANGE.PSM","ESDATE_RANGE.CY","ESDATE_RANGE.PY","ESDATE_RANGE.CFP","ESDATE_RANGE.SSFYUTD","ESDATE_RANGE.SFYTEFP","ESDATE_RANGE.PFP","ESDATE_RANGE.SLFPUTD","ESDATE_RANGE.SFYULFP"]),
esComplexParamFunctionOptions=[{caption:"=",value:"EQ"},{caption:"<>",value:"NE"},{caption:"<",value:"LT"},{caption:"<=",value:"LE"},{caption:">",value:"GT"},{caption:">=",value:"GE"},{caption:"[]",value:"RANGE"},{caption:"Κενό",value:"NULL"},{caption:"Μη κενό",value:"NOTNULL"}],_.map(esComplexParamFunctionOptions,function(a){a.caption=esOperTrans["ESCOMPLEX."+a.value]}),esDateRangeOptions=[{dValue:"0",dType:0,title:esOperTrans["ESDATE_RANGE.SDR"]},{dValue:"1",dType:1,title:esOperTrans["ESDATE_RANGE.SD"]},{dValue:"ESDateRange(SpecificDate, #9999/01/01#, SpecificDate, #1753/01/01#)",dType:2,title:esOperTrans["ESDATE_RANGE.ANY"]},{dValue:"ESDateRange(Day)",dType:3,title:esOperTrans["ESDATE_RANGE.TODAY"]},{dValue:"ESDateRange(SpecificDate, #1753/01/01#, Day, 0)",dType:4,title:esOperTrans["ESDATE_RANGE.UTD"]},{dValue:"ESDateRange(Day, 0, SpecificDate, #9999/01/01#)",dType:5,title:esOperTrans["ESDATE_RANGE.SFTD"]},{dValue:"ESDateRange(Day, -1)",dType:6,title:esOperTrans["ESDATE_RANGE.YTD"]},{dValue:"ESDateRange(SpecificDate, #1753/01/01#, Day, -1)",dType:7,title:esOperTrans["ESDATE_RANGE.UTYD"]},{dValue:"ESDateRange(Day, 1)",dType:8,title:esOperTrans["ESDATE_RANGE.TMR"]},{dValue:"ESDateRange(Day, 1, SpecificDate, #9999/01/01#)",dType:9,title:esOperTrans["ESDATE_RANGE.SFTR"]},{dValue:"ESDateRange(Week)",dType:10,title:esOperTrans["ESDATE_RANGE.CW"]},{dValue:"ESDateRange(Week, -1)",dType:11,title:esOperTrans["ESDATE_RANGE.PW"]},{dValue:"ESDateRange(Week, 1)",dType:12,title:esOperTrans["ESDATE_RANGE.NW"]},{dValue:"ESDateRange(Month)",dType:13,title:esOperTrans["ESDATE_RANGE.CM"]},{dValue:"ESDateRange(Month, 0, SpecificDate, #9999/01/01#)",dType:14,title:esOperTrans["ESDATE_RANGE.SFM"]},{dValue:"ESDateRange(SpecificDate, #1753/01/01#, Month, 0)",dType:15,title:esOperTrans["ESDATE_RANGE.UEM"]},{dValue:"ESDateRange(Month, -1)",dType:16,title:esOperTrans["ESDATE_RANGE.PM"]},{dValue:"ESDateRange(Month, -1, SpecificDate, #9999/01/01#)",dType:17,title:esOperTrans["ESDATE_RANGE.SFLM"]},{dValue:"ESDateRange(SpecificDate, #1753/01/01#, Month, -1)",dType:18,title:esOperTrans["ESDATE_RANGE.UELM"]},{dValue:"ESDateRange(Quarter)",dType:19,title:esOperTrans["ESDATE_RANGE.CQ"]},{dValue:"ESDateRange(Quarter, -1)",dType:20,title:esOperTrans["ESDATE_RANGE.PQ"]},{dValue:"ESDateRange(SixMonth)",dType:21,title:esOperTrans["ESDATE_RANGE.CSM"]},{dValue:"ESDateRange(SixMonth, -1)",dType:22,title:esOperTrans["ESDATE_RANGE.PSM"]},{dValue:"ESDateRange(Year)",dType:23,title:esOperTrans["ESDATE_RANGE.CY"]},{dValue:"ESDateRange(Year, -1)",dType:24,title:esOperTrans["ESDATE_RANGE.PY"]},{dValue:"ESDateRange(FiscalPeriod)",dType:25,title:esOperTrans["ESDATE_RANGE.CFP"]},{dValue:"ESDateRange(FiscalYear, 0, Day, 0)",dType:26,title:esOperTrans["ESDATE_RANGE.SSFYUTD"]},{dValue:"ESDateRange(FiscalYear, 0, FiscalPeriod, 0)",dType:27,title:esOperTrans["ESDATE_RANGE.SFYTEFP"]},{dValue:"ESDateRange(FiscalPeriod, -1)",dType:28,title:esOperTrans["ESDATE_RANGE.PFP"]},{dValue:"ESDateRange(FiscalPeriod, -1, Day, 0)",dType:29,title:esOperTrans["ESDATE_RANGE.SLFPUTD"]},{dValue:"ESDateRange(FiscalYear, 0, FiscalPeriod, -1)",dType:30,title:esOperTrans["ESDATE_RANGE.SFYULFP"]}]});var _esSupportedLanguages=[{id:"el-GR",title:"Ελληνικά (GR)",icon:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAE3SURBVHjapJOxSgNBEEDfspsoiSaSIgat5CwsRCT2goqNnb9h4S+olSiWFjZWthYKaiUJaH7A6kRitJEjigiJXsjlzrGJuSJBueQ1y7Izw5vdHSUiDIIC4sBIe42CB3waIL10VHil6VPYXAVg+fAaYhq+/7YrbqxkDZAMGi0WJsY6B/PZFCqmWZ/N9VQW4K32RRGSCrBEpNxX/0pNG4AgCNBadwWsHd/0TMwk4jy/1zp7a2brVBb3r+SXue0zye9dyl+4riuAZQBaBJTrjU7FR7eJ8QNyO+co1W2QGo5hWmG85TiORMVxnNAgf3CByYzjev7/NyeQGDL4H9XQwLbtyAa2bYcGJ7d3TFWbkZ7w6eEeAAN4u6UKlCr9fAVPAWlgEhiNmFwHXhSg24OkIxYIAE8NOs4/AwC7uO3xQbABsAAAAABJRU5ErkJggg=="},{id:"en-US",title:"English (US)",icon:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAFuSURBVHjapJM/SEJRGMV/Lx9lWGoENjhkOCVBBUYRUUNZ0aBE2VbQHOLaoBA4GrRGEIoIgdLQ1GASGlTjW2oI4U06GCTRH8yQ2yKKPIdeHbj8uMN37uHjHkkIwX8kAd1AX4N6VAPeZcDi8RyV/f4Z0ul7OtF/dtjRYeD63CYBjuPjW7VQKLKw4CKXe9QwGt3sHF+SRmTAkEzeEAyuEovn8XndxON5vF43sVgOn2+K1/XdtsGuwQG+H54ADDLAxsY0qdQdK8sTJBJ5trZm27hzFdO8Xq/XQZaRAU5PswQCa5ycZNnentfwZXyxPbrVwmf5uXl3HhxciOHhfREOXwqrNahhJ1UqFQE4AZx2+56IRDLCbA6IUOhSw3Kvo+0828bEw5CrZaCqqtArVVUF4JQBSqNzmIwmRPXrd7/P2EOp+tHagaIouhMoitJMUCtPLpH5WxVqEmAB7EC/zuE3oCgBhkaRDDoN6kBN+m+dfwYAI5QcdaFOn+AAAAAASUVORK5CYII="},{id:"ro-RO",title:"Românesc (RO)",icon:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAFTSURBVHjapJM9TgMxEEafs5sgSEgEBUJwBAQNJ+AaVNyJI0BLRc8NEIgaQVIAEgKym0Ra/+x6KIhiO9BEWBpZn2w/fx7PKBHhP0MBHaA3n1cZFpjlwODk7PJ9efXm/CLRb6e9X4S966udHOg2jef4YDddzY4SuXa4HpkWzP0DQDcHMusaJjPDZ1GFE34IyOKQG3UDe3sLcQ4gywGMdYwnmvFEB4AUiQNf1EG0WtTGAJADVJXho6gop4bFr0ixsAvgyyYYAlylY0DF46ihnJroyqfEgXseBAP9PlWeBYDWGslzfFITPk1qE7S4Gu1sBDCGjA28jwASAwR80Kp2mJ8k0gIwusJ7Qc1frRbfFYUKIV7QNkqitZaOFzrtLKrRpcLstIMf8RgbnmBFPNOvYbL/9q5M9Gvp/yxnBQyAfWBzxV6YAi8KyOaNlK0IaACr/tvO3wMAJOGiBWzsFlIAAAAASUVORK5CYII="},{id:"bg-BG",title:"Bulgară (BG)",icon:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAADmSURBVHjapJM9TsQwEIW/SeIsIUCklaBBXAWuxFnoqDkOHRegQEgIpAUWlMTD2kNBoixdfl4zcvG+8dhvxMxYIgFy4KirU6TAdwZUZvY6q7vIWQKUCyYoEyBdAEgTgBDCZGfvyQCu7q45rdZsfY1hey8s/869qlXJ2+dmADSt59Fe2Go9qvtJfkjqbR9Qk7gV0eIowC7u0NYPgNubey5cTmyaUYCkKHj6US57QKuKZQ5ERgHMjFZ1uIH3Hg4KxLlxXxDjn6cDaDDj4eN9Tg5UgAo4B44nmr+AZ+mSmM9IZABUlq7z7wChM1nCssShPAAAAABJRU5ErkJggg=="}];ESPropertySet.prototype.getSections=function(){var a=this.ps;return a&&a.Lines?_.groupBy(a.Lines,"Category_Code"):[]};var dDateRangeClass={6:[0,1,2,3,6,8,10,11,12,13,16,19,20,21,22,23,24],20:[0,1,25,26,27,28,29,30]},getLocale=function(){var a=window.esLoginLanguage,b=esClientSession;return b&&b.connectionModel&&b.connectionModel.LangID&&(a=b.connectionModel.LangID),a},dateRangeResolve=function(a,b){var c=_.find(esDateRangeOptions,{dType:2}),d=c?c.title:"Any Date";if(!a||!a.dRange)return d;var e=new Date,f=e.getFullYear(),g=e.getMonth(),h=_.find(esDateRangeOptions,{dValue:a.dRange});if(!h)return d;var i=getLocale();switch(h.dType){case 0:if(!angular.isDate(a.fromD)&&!angular.isDate(a.toD))return d;var j="";angular.isDate(a.fromD)&&(j=a.fromD.toLocaleDateString(i)),j+=" - ";var k="";return angular.isDate(a.toD)&&(k=a.toD.toLocaleDateString(i)),j+=k;case 1:return angular.isDate(a.fromD)?a.fromD.toLocaleDateString(i):d;case 2:return h.title;case 3:return e.toLocaleDateString(i)+" ("+h.title+")";case 4:return"-> "+e.toLocaleDateString(i)+" ("+h.title+")";case 5:return e.toLocaleDateString(i)+" -> ("+h.title+")";case 6:return e.setDate(e.getDate()-1),e.toLocaleDateString(i)+" ("+h.title+")";case 7:return e.setDate(e.getDate()-1),e.toLocaleDateString(i)+" -> ("+h.title+")";case 8:return e.setDate(e.getDate()+1),e.toLocaleDateString(i)+" ("+h.title+")";case 9:return e.setDate(e.getDate()+1),e.toLocaleDateString(i)+" -> ("+h.title+")";case 10:var l=e.getDay(),m=0==l?6:l-1,n=new Date(e),o=new Date(e);return n.setDate(e.getDate()-m),o.setDate(n.getDate()+6),n.toLocaleDateString(i)+" - "+o.toLocaleDateString(i)+" ("+h.title+")";case 11:e.setDate(e.getDate()-7);var l=e.getDay(),m=0==l?6:l-1,n=new Date(e),o=new Date(e);return n.setDate(e.getDate()-m),o.setDate(n.getDate()+6),n.toLocaleDateString(i)+" - "+o.toLocaleDateString(i)+" ("+h.title+")";case 12:e.setDate(e.getDate()+7);var l=e.getDay(),m=0==l?6:l-1,n=new Date(e),o=new Date(e);return n.setDate(e.getDate()-m),o.setDate(n.getDate()+6),n.toLocaleDateString(i)+" - "+o.toLocaleDateString(i)+" ("+h.title+")";case 13:e.setDate(1);var n=new Date(f,g+1,0);return e.toLocaleDateString(i)+" - "+n.toLocaleDateString(i)+" ("+h.title+")";case 14:return e.setDate(1),e.toLocaleDateString(i)+" -> ("+h.title+")";case 15:var n=new Date(f,g+1,0);return"-> "+n.toLocaleDateString(i)+" ("+h.title+")";case 16:var n=new Date(f,g-1,1),o=new Date(f,g,0);return n.toLocaleDateString(i)+" - "+o.toLocaleDateString(i)+" ("+h.title+")";case 17:var n=new Date(f,g-1,1);return n.toLocaleDateString(i)+" -> ("+h.title+")";case 18:var n=new Date(f,g,0);return"-> "+n.toLocaleDateString(i)+" ("+h.title+")";case 19:var p=g,q=p%3,n=new Date(f,p-q,1),o=new Date(f,p+(3-q),0);return n.toLocaleDateString(i)+" -> "+o.toLocaleDateString(i)+" ("+h.title+")";case 20:var p=g,q=p%3,o=new Date(f,p-q,0),n=new Date(f,o.getMonth()-2,1);return n.toLocaleDateString(i)+" -> "+o.toLocaleDateString(i)+" ("+h.title+")";case 21:var p=g,n=new Date(f,p>=6?6:0,1),o=new Date(f,p>=6?11:5,p>=6?31:30);return n.toLocaleDateString(i)+" -> "+o.toLocaleDateString(i)+" ("+h.title+")";case 22:var n,o,r=f,p=g;return p>=6?(n=new Date(r,0,1),o=new Date(r,5,30)):(n=new Date(r-1,6,1),o=new Date(r-1,11,31)),n.toLocaleDateString(i)+" -> "+o.toLocaleDateString(i)+" ("+h.title+")";case 23:var r=f,n=new Date(r,0,1),o=new Date(r,11,31);return n.toLocaleDateString(i)+" -> "+o.toLocaleDateString(i)+" ("+h.title+")";case 24:var r=f-1,n=new Date(r,0,1),o=new Date(r,11,31);return n.toLocaleDateString(i)+" -> "+o.toLocaleDateString(i)+" ("+h.title+")";default:return h.title}};ESParamVal.prototype.getParameterInfo=function(){return{parameterType:"esGenericParam"}},ESParamVal.prototype.required=function(a){return arguments&&0!=arguments.length?(this.mandatory=!!a,this):this.mandatory},ESParamVal.prototype.getExecuteVal=function(){return this.paramValue},ESParamVal.prototype.clone=function(a){var b=new ESParamVal(a,this.pValue(),this.enumList);return b.required(this.required()),b},ESParamVal.prototype.pValue=function(a){return arguments&&0!=arguments.length?this.paramValue===arguments[0]?!1:(this.paramValue=arguments[0],!0):this.paramValue},ESParamVal.prototype.strVal=function(){var a=this.enumList;if(!a||0==a.length)return this.paramValue?this.paramValue.toString():"";if(!this.paramValue)return"";var b;b=angular.isArray(this.paramValue)?this.paramValue:[this.paramValue];var c=_.reduce(b,function(b,c){var d=_.find(a,{value:c.toString()});return b+(d?d.text:c.toString())+", "},"");return c.substring(0,c.lastIndexOf(", "))},ESBoolParamVal.prototype=Object.create(ESParamVal.prototype),ESBoolParamVal.prototype.clone=function(a){return new ESBoolParamVal(a,this.pValue())},ESBoolParamVal.prototype.getParameterInfo=function(){return{parameterType:"system.int32, mscorlib",controlType:7}},ESBoolParamVal.prototype.strVal=function(){return esYesNoTrans[this.pValue()?"ESUI.BOOLEAN.YES":"ESUI.BOOLEAN.NO"]},ESBoolParamVal.prototype.getExecuteVal=function(){return this.pValue()?1:0},ESNumericParamVal.prototype=Object.create(ESParamVal.prototype),ESNumericParamVal.prototype.clone=function(a){return new ESNumericParamVal(a,this.pValue())},ESNumericParamVal.prototype.getParameterInfo=function(){return{parameterType:"entersoft.framework.platform.esnumeric"}},ESNumericParamVal.prototype.strVal=function(){var a="0",b=this.paramValue.value?this.paramValue.value.toLocaleString(getLocale()):a,c=this.paramValue.valueTo?this.paramValue.valueTo.toLocaleString(getLocale()):a;switch(this.paramValue.oper){case"RANGE":return esOperTrans["ESCOMPLEX.FROM"]+b+esOperTrans["ESCOMPLEX.TO"]+c;case"NULL":return esOperTrans["ESCOMPLEX.NULL"];case"NOTNULL":return esOperTrans["ESCOMPLEX.NOTNULL"];default:return esOperTrans["ESCOMPLEX."+this.paramValue.oper.toString()]+" "+b}},ESNumericParamVal.prototype.getExecuteVal=function(){var a=(this.paramValue.value=this.paramValue.value||0).toLocaleString("el-GR"),b=(this.paramValue.valueTo=this.paramValue.valueTo||0).toLocaleString("el-GR");switch(this.paramValue.oper){case"RANGE":return"ESNumeric("+this.paramValue.oper+", '"+a+"', '"+b+"')";case"NULL":case"NOTNULL":return"ESNumeric("+this.paramValue.oper+", '0')";default:return"ESNumeric("+this.paramValue.oper+", '"+a+"')"}},ESStringParamVal.prototype=Object.create(ESParamVal.prototype),ESStringParamVal.prototype.clone=function(a){return new ESStringParamVal(a,this.pValue())},ESStringParamVal.prototype.getParameterInfo=function(){return{parameterType:"entersoft.framework.platform.esstring, queryprocess"}},ESStringParamVal.prototype.strVal=function(){var a=this.paramValue.value?this.paramValue.value.toString():"",b=this.paramValue.valueTo?this.paramValue.valueTo.toString():"";switch(this.paramValue.oper){case"RANGE":return esOperTrans["ESCOMPLEX.FROM"]+a+esOperTrans["ESCOMPLEX.TO"]+b;case"NULL":return esOperTrans["ESCOMPLEX.NULL"];case"NOTNULL":return esOperTrans["ESCOMPLEX.NOTNULL"];default:return esOperTrans["ESCOMPLEX."+this.paramValue.oper.toString()]+" "+a}},ESStringParamVal.prototype.getExecuteVal=function(){switch(this.paramValue.oper){case"EQ":return this.paramValue.value;case"RANGE":return"ESString("+this.paramValue.oper+", '"+this.paramValue.value+"', '"+this.paramValue.valueTo+"')";case"NULL":case"NOTNULL":return"ESString("+this.paramValue.oper+", '')";default:return"ESString("+this.paramValue.oper+", '"+this.paramValue.value+"')"}},ESDateParamVal.prototype=Object.create(ESParamVal.prototype),ESDateParamVal.prototype.clone=function(a){return new ESDateParamVal(a,this.pValue())},ESDateParamVal.prototype.getParameterInfo=function(){return{parameterType:"entersoft.framework.platform.esdaterange, queryprocess"}},ESDateParamVal.prototype.strVal=function(a){return dateRangeResolve(this.paramValue,a)},ESDateParamVal.prototype.getExecuteVal=function(){var a=this.paramValue.dRange;if("0"==a||"1"==a){var b="#1753/01/01#",c="#9999/01/01#",d=!0,e=moment(this.paramValue.fromD);e.isValid()&&(d=!1,b=e.format("YYYY/MM/DD"));var f=moment(this.paramValue.toD);return f.isValid()&&(d=!1,c=f.format("YYYY/MM/DD")),"0"==a||d?"ESDateRange(SpecificDate, #"+b+"#, SpecificDate, #"+c+"#)":"ESDateRange(SpecificDate, #"+b+"#)"}return this.paramValue.dRange},ESParamValues.prototype.merge=function(a){var b=this;if(a)for(var c in a){if(!a[c]||!a[c]instanceof ESParamVal)throw new Error("Invalid parameter type in merge function in paramvalues");b.hasOwnProperty(c)&&b[c]instanceof ESParamVal?b[c].enumList=a[c].enumList:b[c]=a[c]}return this},ESParamValues.prototype.isValidState=function(){var a=this;for(var b in a)if(a.hasOwnProperty(b)){var c=a[b];if(c instanceof ESParamVal&&c.required()&&!(c.paramValue&&c.getExecuteVal()||angular.isNumber(c.paramValue)&&0==c.paramValue))return!1}return!0},ESParamValues.prototype.setParamValues=function(a){var b=this;for(var c in b)b.hasOwnProperty(c)&&delete b[c];a&&_.isArray(a)&&0!=a.length&&a.forEach(function(a,c,d){b[a.paramCode]=a})},ESParamValues.prototype.getExecuteVals=function(){var a=this,b={};for(var c in a)if(a.hasOwnProperty(c)){var d=a[c];(d.paramValue||angular.isNumber(d.paramValue)&&0==d.paramValue)&&(b[d.paramCode]=d.getExecuteVal())}return b},ESParamValues.prototype.getSerialized=function(){var a=this,b=[];for(var c in a)if(a.hasOwnProperty(c)){var d=a[c];if(d.paramValue||angular.isNumber(d.paramValue)&&0==d.paramValue){var e=d.getParameterInfo();if(!e||!e.parameterType)throw new Error("Parameter cannot be serialized ["+d.paramCode+"]");b.push({id:d.paramCode,value:d.getExecuteVal(),parameterType:e.parameterType,controlType:e.controlType,enumList:d.enumList,required:d.mandatory})}}return b};var esClientSession={hostUrl:"",connectionModel:null,setWebApiToken:function(a,b){a&&angular.isString(a)&&(esClientSession.connectionModel?a!==esClientSession.connectionModel.WebApiToken&&(esClientSession.connectionModel.WebApiToken=a):(esClientSession.connectionModel={},esClientSession.connectionModel.WebApiToken=a))},getWebApiToken:function(){var a=getAuthToken(fgetModel());return a},setModel:fsetModel,getModel:fgetModel},isMobile=function(){var a=!1;return function(b,c){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(b)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(b.substr(0,4)))&&(a=!0)}(navigator.userAgent||navigator.vendor||window.opera),a}();return{requiredEBSVersion:requiredEBSVersion,esConvertGIDtoId:esConvertGIDtoId,esDetectMobileBrowsers:function(){return isMobile},getLocale:getLocale,esConvertIDtoGID:esConvertIDtoGID,rgbToHex:rgbToHex,isEmail:function(a){return a&&/mail/i.test(a)},isPhone:function(a){return a&&(/mobile/i.test(a)||/phone/i.test(a))},getVersion:function(){return esAngularAPIVer},isObjectEmpty:function(a){if(!a)return!0;for(var b in a)if(a.hasOwnProperty(b))return!1;return!0},esSupportedLanguages:_esSupportedLanguages,suggestESLanguageID:suggestESLanguageID,getMimeTypeForExt:function(a,b){if(!b)return"";var c=b.split("."),d=c[c.length-1].toLowerCase();if(!d)return"";var e=_.find(a,function(a){return-1!=a.extension.indexOf(d)});return e?e.mime:""},getExtensionsForMimeType:function(a,b){if(!b)return[];b=b.toLowerCase();var c=_.find(mimelist,function(a){return a.mime==b});return c?c.extension:[]},setWebApiToken:esClientSession.setWebApiToken,getWebApiToken:function(){return esClientSession.getWebApiToken()},isAuthenticated:function(){return fgetModel(),!!esClientSession.connectionModel},getClientSession:function(){return esClientSession},getUserMessage:getUserMessage,getESUISettings:function(){return esUISettings},ESPublicQueryDef:ESPublicQueryDef,ESMultiZoomDef:ESMultiZoomDef,ESPQOptions:ESPQOptions,ESParamValues:ESParamValues,ESParamVal:ESParamVal,ESNumericParamVal:ESNumericParamVal,ESStringParamVal:ESStringParamVal,ESDateParamVal:ESDateParamVal,ESBoolParamVal:ESBoolParamVal,getesDateRangeOptions:fGetesDateRangeOptions,getesComplexParamFunctionOptions:function(){return esComplexParamFunctionOptions},sessionClosed:function(){esClientSession.setModel(null);try{esCache.clear()}catch(a){}},sessionOpened:function(a,b){try{try{esCache.clear()}catch(c){}a.Model.LangID=a.Model.LangID||(b||{}).LangID||window.esLoginLanguage,a.Model.BranchID=a.Model.BranchID||(b||{}).BranchID||"-",a.Model.Claims=a.Claims,angular.isUndefined(a.IsExternal)?a.Model.IsExternal=a.Claims&&a.Claims.IsExternal:a.Model.IsExternal=a.IsExternal,esClientSession.setModel(a.Model),$log.info("LOGIN User ",a.Model.Name)}catch(d){throw $log.error(d),d}}}}])}(),function(){"use strict";var a=angular.module("es.Services.Web");a.factory("esStackTrace",function(){var a;try{a=printStackTrace}catch(b){a=StackTrace}return{print:a}}),a.provider("$log",function(){function a(){return log4javascript.getLogger("esLogger")}function b(a){d(new log4javascript.BrowserConsoleAppender);var b=angular.isDefined(a)&&a;b&&d(new log4javascript.PopUpAppender)}function c(a,b){if(f){i&&a&&a.connectionModel&&(i.setCustomField("userId",a.connectionModel.UserID),i.setCustomField("branchId",a.connectionModel.BranchID),i.setCustomField("langId",a.connectionModel.LangID));var c=f.getHeaders();if(c){var d,e=-1;for(d=0;d<c.length;d++)if("Authorization"==c[d].name){e=d;break}-1!=e&&c.splice(e,1)}b&&""!=b&&f.addHeader("Authorization",b)}}function d(a){return-1==e.indexOf(a)?(e.push(a),!0):!1}var e=[],f=null,g=null,h=log4javascript.Level.ALL,i=null;return{setLevel:function(a){h=a,g&&g.setLevel(h)},getLevel:function(){return h},getCurrentLevel:function(){return g?g.getEffectiveLevel():log4javascript.Level.OFF},addAppender:d,addDefaultAppenders:b,addESWebApiAppender:function(a,b){var c=a+"api/rpc/EventLog/";return f=new log4javascript.AjaxAppender(c,!1),f.setSendAllOnUnload(!0),i=new log4javascript.JsonLayout,i.setCustomField("subscriptionId",b),f.setLayout(i),f.setWaitForResponse(!0),f.setBatchSize(100),f.setTimed(!0),f.setTimerInterval(6e4),f.addHeader("Content-Type","application/json"),f.setRequestSuccessCallback(function(a){console.log("ES Logger, BATCH of logs upoloaded",a.responseURL,a.status)}),f.setFailCallback(function(a){console.error("Failed to POST Logs to the server",a)}),d(f)},$get:["esMessaging",function(d){try{g=a(),g.setLevel(h),0==e.length&&b();var i=0;for(i=0;i<e.length;i++)g.addAppender(e[i]);return d.subscribe("AUTH_CHANGED",function(a,b){c(a,b)}),g.sendAll=function(){try{f&&f.sendAll()}catch(a){}},console.info("ES Logger started"),g}catch(j){return console.log("Error in starting entersoft logger",j),$log}}]}}),a.provider("$exceptionHandler",function(){var a={pushToServer:!1,logServer:""};return{getSettings:function(){return a},setPushToServer:function(b){a.pushToServer=b},setLogServer:function(b){a.logServer=b},$get:["$log","$window","esStackTrace","$injector",function(b,c,d,e){function f(f,g){var h,i,j;try{var k=e.get("esMessaging");k.publish("ES_HTTP_CORE_ERR",f),h=f.toString(),i=d.print({e:f}),j={errorUrl:c.location.href,errorMessage:h,stackTrace:i,cause:g||""},b.error(JSON.stringify(j,null,"	"))}catch(l){console.log(arguments)}if(a.pushToServer)try{var m=e.get("esWebApi");m.registerException(j,a.logServer)}catch(l){b.warn("ES Error in registerException on store "+a.logServer),b.error(l)}}return f}]}})}(),function(){"use strict";function doChangeLanguage(a,b,c,d,e){b=b||window.esLoginLanguage;var f=e.get("esCache"),g=b.split("-")[0],h=window.ESIsB2B?"/assets/collab/":"";if(a.use(g),Globalize&&(f.getItem("Globalize_"+b)?Globalize.locale(b):c.all([d.get(h+"languages/"+g+"-ca-gregorian.json"),d.get(h+"languages/"+g+"-numbers.json"),d.get(h+"languages/"+g+"-currencies.json"),d.get(h+"languages/likelySubtags.json"),d.get(h+"languages/timeData.json"),d.get(h+"languages/weekData.json"),d.get(h+"languages/currencyData.json"),d.get(h+"languages/numberingSystems.json")]).then(function(a){_.forEach(a,function(a){Globalize.load(a.data)})}).then(function(){Globalize.locale(b),f&&f.setItem("Globalize_"+b,!0)})["catch"](function(a){throw a}),kendo&&(kendo.culture(b),!f.getItem("kendo_"+b)))){var i=h+"languages/kendo.messages."+b+".min.js";$.getScript(i,function(){f.setItem("kendo_"+b,!0)})}}function getPivotColFormatType(a){var b=a.dataType;switch(b){case"decimal":var c=a.format,d=0;if(c){var e=c.indexOf(".");if(-1!=e){var f=c.slice(e),g=f.split("0").length-1;d=0>g?0:g}}return{type:"fixedPoint",precision:d};case"datetime":return"shortDateShortTime";case"date":return"shortDate";default:return null}}function ESFavourites(a){if(this.shortcuts=[],this.lastModified=new Date,a){if(angular.isString(a)){var b=JSON.parse(a);return this.shortcuts=b.shortcuts||[],void(this.lastModified=b.lastModified)}angular.isArray(a)&&(this.shortcuts=a)}}function ESMasterDetailGridRelation(a,b,c,d){this.relationID=a,this.detailDataSource=b,this.detailParams=c,this.detailParamCode=d||"ISUDGID"}function ESRequeryDetailGrids(){this.registeredRelations=[]}function esAskForField(a,b){if(b){var c=a.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",template:"<div ng-include src=\"'src/partials/esAskForField.html'\"></div>",controller:"esAskForFieldCtrl",controllerAs:"$ctrl",size:"sm",appendTo:null,resolve:{inDef:function(){return b}}});return c.result}}function esChangePassword(a,b){if(b){var c=a.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",template:"<div ng-include src=\"'src/partials/esChangePassword.html'\"></div>",controller:"esChangePasswordCtrl",controllerAs:"$ctrl",size:"md",appendTo:null,resolve:{inDef:function(){return b}}});return c.result}}function esResolveBlobUrl(a,b){return a&&angular.isString(a)?0===a.toLowerCase().trim().indexOf("http://")||0===a.toLowerCase().trim().indexOf("https://")?a:b.downloadES00BlobURLByGID(a,0):null}function esResolveUserLogoUrl(a,b){return a&&angular.isString(a)?0===a.toLowerCase().trim().indexOf("http://")||0===a.toLowerCase().trim().indexOf("https://")?a:b.userLogoUrl(a):null}function convertPQRowsToMapRows(a,b){if(!a)return a;if(angular.isArray(a)&&0==a.length)return a;var c=_.forEach(a,function(a){a.latlng=[a.Latitude,a.Longitude]});return _.filter(c,function(a){return a.Longitude&&a.Latitude?b?a[b]>0:!0:!1})}var esWEBUI=angular.module("es.Web.UI",["ngAnimate","ui.bootstrap","ngSanitize","pascalprecht.translate","dx","angular-clipboard"]);esWEBUI.run(["$translate","esMessaging","$q","$http","$injector",function(a,b,c,d,e){window.esLoginLanguage=navigator.language||navigator.userLanguage||"en-US",b.subscribe("AUTH_CHANGED",function(b,f){var g=b&&b.connectionModel&&b.connectionModel.LangID?b.connectionModel.LangID:window.esLoginLanguage;if(doChangeLanguage(a,g,c,d,e),b&&b.connectionModel&&f){var h=e.get("esWebApi"),i=e.get("esCache");if(DevExpress&&h&&i){var j=i.getItem("ES_BASE_CURR");if(j)return void DevExpress.config({defaultCurrency:j});b.connectionModel.IsExternal?DevExpress.config({defaultCurrency:"EUR"}):h.getParameterValue("ESFICALYEARBASECURRENCY").then(function(a){i.setItem("ES_BASE_CURR",a.data),DevExpress.config({defaultCurrency:a.data})})["catch"](function(a){})}}})}]),$(document).on("click.nav",".navbar-collapse.in",function(a){$(a.target).is("a")&&$(this).removeClass("in").addClass("collapse")});const FAVOURITES_TYPEID=9e3,ESLINK_TYPEID=9100;var loadFavourites=function(a,b,c,d,e){var f=a.defer(),g=e.getItem("ES_USR_FAV");return g?f.resolve(g):d.getBodyFromES00Blob("ESGOUser",b.getClientSession().connectionModel.GID,9e3).then(function(a){var b=new ESFavourites(a.data.TextBody);e.setItem("ES_USR_FAV",b),f.resolve(b)})["catch"](function(a){f.reject(a)}),f.promise};ESFavourites.prototype.addRemoveFav=function(a,b,c,d,e,f){if(d&&d.CtxID){var g=d.CtxID.toLowerCase();if(angular.isDefined(f))_.pullAt(this.shortcuts,f),b.publish("FAV_REMOVED",g);else{var h={ID:g,Params:d.Params.getSerialized(),Title:e};this.shortcuts.push(h)}return this.save(a,c)}},ESFavourites.prototype.clearAll=function(a,b){return this.lastModified=new Date,this.shortcuts=[],this.save(a,b)},ESFavourites.prototype.save=function(a,b){this.lastModified=new Date;var c={ObjectID:"ESGOUser",KeyID:a.getClientSession().connectionModel.GID,TypeID:FAVOURITES_TYPEID,TextBody:JSON.stringify(this)};return b.postBodyToES00Blob(c)},ESFavourites.prototype.moveUpOrDown=function(a,b,c,d){if(this.shortcuts&&!(this.shortcuts.length<2)&&-1!=c&&!(0==c&&d||c==this.shortcuts.length-1&&!d)){var e=d?c-1:c+1,f=this.shortcuts[e];this.shortcuts[e]=this.shortcuts[c],this.shortcuts[c]=f;var g=this.save(a,b);return{from:c,to:e,promise:g}}},ESRequeryDetailGrids.prototype.addDetailRelation=function(a){if(!(a&&a instanceof ESMasterDetailGridRelation))throw"relInfo parameter is null or is not of type ESMasterDetailGridRelation";if(!a.relationID)throw"The parameter does not contain relationID or is null/emptystring/undefined";var b=a.relationID.toLowerCase(),c=_.findIndex(this.registeredRelations,function(a){return a.relationID.toLowerCase()==b});return 0>c?this.registeredRelations.push(a):this.registeredRelations[c]=a,this},ESRequeryDetailGrids.prototype.getDetailRelation=function(a){if(!relationID)throw"relationID is null/emptystring/undefined";var b=relationID.toLowerCase(),c=_.findIndex(this.registeredRelations,function(a){return a.toLowerCase()==b});return 0>c?null:this.registeredRelations[c]},ESRequeryDetailGrids.prototype.removeDetailRelation=function(a){if(!relationID)throw"relationID is null/emptystring/undefined";var b=relationID.toLowerCase(),c=_.findIndex(this.registeredRelations,function(a){return a.toLowerCase()==b});return 0>c?!1:(this.registeredRelations=this.registeredRelations.splice(c,1),!0)},esWEBUI.filter("esTrustHtml",["$sce",function(a){return function(b){return a.trustAsHtml(b)}}]).filter("esParamTypeMapper",["esUIHelper",function(a){var b=function(b){return b&&b instanceof a.ESParamInfo?b.paramTemplate():""};return b}]).directive("errSrc",function(){return{link:function(a,b,c){b.bind("error",function(){c.src!=c.errSrc&&c.$set("src",c.errSrc)})}}}).directive("esPositiveInteger",["$parse",function(a){var b=/^\+?\d+$/;return{require:"ngModel",restrict:"A",link:function(c,d,e,f){var g=!1;if(angular.isDefined(e.esPositiveInteger))try{g=a(e.esPositiveInteger)(c)}catch(h){}f.$validators.esPositiveInteger=function(a,c){return(f.$isEmpty(a)||g?0>a:0>=a)?!1:b.test(c)?!0:!1}}}}]).directive("esLogin",["$q","$http","$translate","$log","$uibModal","esWebApi","esUIHelper","esGlobals","$sanitize","$injector",function(a,b,c,d,e,f,g,h,i,j){return{restrict:"AE",scope:{esShowSubscription:"=",esShowOnPremises:"=",esShowBridge:"=",esCredentials:"=",esShowStickySession:"=",esLoginLabel:"@?",esLoginVersion:"@?",esLoginUrl:"@?",esLoginTerms:"@?",esLoginTermsUrl:"@?",esLoginSignUp:"@?",esLoginSignUpUrl:"@?",esLoginIcon:"=?",esLoginShowRememberMe:"=?",esOnSuccess:"&"},template:"<div ng-include src=\"'src/partials/esLogin.html'\"></div>",link:function(d,e,f){var g=function(){if(d.esCredentials.LangID){var e=d.esCredentials.LangID;doChangeLanguage(c,e,a,b,j)}window.esLoginLanguage=d.esCredentials.LangID||navigator.language||navigator.userLanguage||"en-US"};if(d.esGlobals=h,d.esLangOptions={dataSource:h.esSupportedLanguages,dataTextField:"title",dataValueField:"id",change:g,valuePrimitive:!0,autoBind:!0,valueTemplate:"<img ng-src={{dataItem.icon}}></img><span>{{dataItem.title}}</span>",template:"<img ng-src={{dataItem.icon}}></img><span>{{dataItem.title}}</span>"},d.esCredentials.LangID){var i=d.esCredentials.LangID;doChangeLanguage(c,i,a,b,j)}}}}]).directive("esPropertyQuestion",["$log","$uibModal","esWebApi","esUIHelper","esGlobals","$sanitize",function(a,b,c,d,e,f){return{restrict:"AE",scope:{esQuestion:"=",esPsDef:"=",esPsVal:"="},template:"<div ng-include src=\"'src/partials/esSurvey/esPropertyQuestion_'+esQuestion.PType+'.html'\"></div>",link:function(a,b,c){a.esGlobals=e;var f=a.esQuestion;f&&f.PArg&&7==f.PType&&(a[f.PArg+"_DS"]=d.getZoomDataSource(f.PArg)),a.openCalendar=function(b){a.calendarStatus.opened=!0},a.calendarStatus={opened:!1},a.calendarFormat="dd-MMMM-yyyy",a.getScale=function(a){return!a||isNaN(a)?[]:_.range(1,Math.abs(parseInt(a))+1)},a.getChoicesOfQuestion=function(){return a.esQuestion&&a.esQuestion.PArg&&a.esPsDef&&a.esPsDef.Choices?_.sortBy(_.filter(a.esPsDef.Choices,{ChoiceCode:a.esQuestion.PArg}),"OrderPriority"):[]}}}}]),esWEBUI.filter("esPQDSToesMapDS",function(){return convertPQRowsToMapRows}).directive("esSurvey",["$log","$uibModal","esWebApi","esUIHelper","esGlobals","$sanitize",function(a,b,c,d,e,f){return{restrict:"AE",scope:{esSectionIdx:"=",esPsDef:"=",esPsVal:"="},template:"<div ng-include src=\"'src/partials/esSurvey/esSurvey.html'\"></div>",
link:function(a,b,c){a.esGlobals=e,a.isIntroduction=function(){return a.esSectionIdx<0},a.isLast=function(){return a.esPsDef&&a.esPsDef.Sections?a.esSectionIdx==a.esPsDef.Sections.length-1:!0},a.saveAndComplete=function(){},a.getQuestionsofSection=function(){if(!a.esPsDef||!a.esPsDef.Sections||a.esSectionIdx<0||a.esSectionId>=a.esPsDef.Sections.length)return[];var b=a.esPsDef.Sections[a.esSectionIdx].Code;return b?_.sortBy(_.filter(a.esPsDef.Lines,{Category_Code:b}),"SeqNum"):[]},a.progress=function(){return a.esSectionIdx<0||!a.esPsDef||!a.esPsDef.Sections||!a.esPsDef.Sections.length?0:Math.round((a.esSectionIdx+1)/a.esPsDef.Sections.length*100)},a.advanceStep=function(){a.isLast()||(a.esSectionIdx+=1)},a.backStep=function(){a.isIntroduction()||(a.esSectionIdx-=1)}}}}]).directive("esChecklistModel",["$parse","$compile",function(a,b){function c(a,b,c){if(angular.isArray(a))for(var d=a.length;d--;)if(c(a[d],b))return!0;return!1}function d(a,b,d){return a=angular.isArray(a)?a:[],c(a,b,d)||a.push(b),a}function e(a,b,c){if(angular.isArray(a))for(var d=a.length;d--;)if(c(a[d],b)){a.splice(d,1);break}return a}function f(f,g,h){function i(){return h.esChecklistValue?a(h.esChecklistValue)(f.$parent):h.value}function j(a,b){var c=m(f.$parent);angular.isFunction(m.assign)&&(b===!0?m.assign(f.$parent,d(c,a,q)):m.assign(f.$parent,e(c,a,q)))}function k(a,b){return o&&o(f)===!1?void j(i(),p(f)):void p.assign(f,c(a,i(),q))}var l=h.esChecklistModel;h.$set("esChecklistModel",null),b(g)(f),h.$set("esChecklistModel",l);var m=a(l),n=a(h.checklistChange),o=a(h.checklistBeforeChange),p=a(h.ngModel),q=angular.equals;if(h.hasOwnProperty("checklistComparator"))if("."==h.checklistComparator[0]){var r=h.checklistComparator.substring(1);q=function(a,b){return a[r]===b[r]}}else q=a(h.checklistComparator)(f.$parent);f.$watch(h.ngModel,function(a,b){if(a!==b){if(o&&o(f)===!1)return void p.assign(f,c(m(f.$parent),i(),q));j(i(),a),n&&n(f)}}),f.$watch(i,function(a,b){if(a!=b&&angular.isDefined(b)&&f[h.ngModel]===!0){var c=m(f.$parent);m.assign(f.$parent,e(c,b,q)),m.assign(f.$parent,d(c,a,q))}}),angular.isFunction(f.$parent.$watchCollection)?f.$parent.$watchCollection(l,k):f.$parent.$watch(l,k,!0)}return{restrict:"A",priority:1e3,terminal:!0,scope:!0,compile:function(a,b){if(!b.esChecklistValue&&!b.value)throw"You should provide `value` or `checklist-value`.";return b.ngModel||b.$set("ngModel","checked"),f}}}]).controller("esComboPQCtrl",["$scope","$log","$window","esMessaging","esWebApi","esUIHelper","esGlobals","$translate","$uibModal","$q","esCache","$timeout","$interval","clipboard",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){function o(a,b){function c(a){var b=a.en;if(b)return b;for(var c in a)return a[c];return""}return b&&(b=b.split("-")[0]),a?angular.isString(a)?a:angular.isObject(a)?b?a[b]||c(a):c(a):a:""}function p(a,b){if(angular.isArray(a))return void _.forEach(a,function(a){p(a,b)});if(a&&a.Title&&(a.Title=o(a.Title,b)),angular.isArray(a))return void p(a,b);if(a&&a.Description&&(a.Description=o(a.Description,b)),a&&a.UIOptions&&a.UIOptions.title&&(a.UIOptions.title=o(a.UIOptions.title,b)),a&&a.UIOptions&&a.UIOptions.valueAxis){var c=angular.isArray(a.UIOptions.valueAxis)?a.UIOptions.valueAxis:[a.UIOptions.valueAxis];_.forEach(c,function(a){a.title&&a.title.text&&(a.title.text=o(a.title.text,b))})}if(a&&a.UIOptions&&a.UIOptions.xAxis){var c=angular.isArray(a.UIOptions.xAxis)?a.UIOptions.xAxis:[a.UIOptions.xAxis];_.forEach(c,function(a){a.title&&a.title.text&&(a.title.text=o(a.title.text,b))})}if(a&&a.UIOptions&&a.UIOptions.yAxis){var c=angular.isArray(a.UIOptions.yAxis)?a.UIOptions.yAxis:[a.UIOptions.yAxis];_.forEach(c,function(a){a.title&&a.title.text&&(a.title.text=o(a.title.text,b))})}if(a&&a.UIOptions&&a.UIOptions.valueAxes){var c=angular.isArray(a.UIOptions.valueAxes)?a.UIOptions.valueAxes:[a.UIOptions.valueAxes];_.forEach(c,function(a){a.title&&a.title.text&&(a.title.text=o(a.title.text,b))})}if(a&&a.UIOptions&&a.UIOptions.series){var c=angular.isArray(a.UIOptions.series)?a.UIOptions.series:[a.UIOptions.series];_.forEach(c,function(a){a.title&&(a.title=o(a.title,b))})}}function q(a,b){return angular.isArray(a)?void _.forEach(a,function(a){q(a,b)}):void(angular.isObject(a)&&(angular.isDefined(a.Title)&&(a.Title=o(a.Title,b)),angular.isDefined(a.Description)&&(a.Description=o(a.Description,b)),p(a,b),a.esDef&&p(a.esDef,b)))}function r(a,b){return b||(b=g.getLocale()),angular.isArray(a)&&(a=_.map(a,function(a){return _.orderBy(a,["AA"])})),q(a,b),a}function s(a){var b=_.map(a,function(a){if(angular.isArray(a))return s(a);var b=(new g.ESPublicQueryDef).initFromObj(a.esDef);return b.ESUIType=a.ESUIType.toLowerCase(),b.CtxID=a.ID,a.esDef&&(b.Params=f.createESParams(a.esDef.Params)),b.AA=a.AA,b.Title=a.Title,b});return b}function t(b){var c=g.getUserMessage(b);c.isLogin||a.showUserMessage(c.messageToShow)}function u(b){return _.findIndex(a.esPqDef,function(a){return a[0]==b})}var v=function(){a.globalExecutePQ=function(b,c){var d=a.esPqDef.GlobalParamsPanel.Parameters;a.esPqDef.GlobalParamsPanel.esPanelOpen.status=!1,_.forEach(a.esPqDef,function(a){_.forEach(a,function(a){_.forEach(d.paramsValues,function(b){var c=a.Params[b.paramCode];c&&c.pValue(b.pValue())}),a.runPQ&&a.runPQ()})})},a.showUserMessage=function(b){a.esShowUserMessage&&angular.isFunction(a.esShowUserMessage)&&a.esShowUserMessage({message:b})},"favourites"==a.esPqDef.ID&&w();var b=[];"escombo"!=a.esPqDef.ESUIType.toLowerCase()?b=[a.esPqDef]:(b=a.esPqDef.esDef,b=_.map(b,function(a){return angular.isArray(a)?a:[a]}));var c,d=s(b);if(c=r("escombo"!=a.esPqDef.ESUIType.toLowerCase()?d[0]:d),a.esPqDef.GlobalParamsPanel){var e=[];if(a.esPqDef.GlobalParamsPanel.Parameters){var h=g.getLocale();_.forEach(a.esPqDef.GlobalParamsPanel.Parameters,function(a){var b=angular.merge({},a);b.caption&&(b.caption=o(b.caption,h)),b.tooltip&&(b.tooltip=o(b.tooltip,h)),e.push(b)})}var i=[],k=new f.ESParamsDefinitions("",[]);k=k.createDefinitions("",e),_.forEach(c,function(a){_.forEach(a,function(a){a.UIOptions&&a.UIOptions.autoBind&&(a.UIOptions.autoBind=!1),a.PQOptions&&a.PQOptions.AutoExecute&&(a.PQOptions.AutoExecute=!1),a.isDonePromise=j.defer();var b=a.isDonePromise.promise;i.push(b)})}),c.GlobalParamsPanel={AutoExecute:a.esPqDef.GlobalParamsPanel.AutoExecute,esPanelOpen:{status:a.esPqDef.GlobalParamsPanel.esPanelOpen&&a.esPqDef.GlobalParamsPanel.esPanelOpen.status},Parameters:k},a.esPqDef.GlobalParamsPanel.ReExecute<1||a.esPqDef.GlobalParamsPanel.ReExecute>=60?(c.GlobalParamsPanel.ReExecute=0,console.log("GlobalParamsPanel.ReExecute value should be between 1 min and 59 mins - "+a.esPqDef.ID)):c.GlobalParamsPanel.ReExecute=a.esPqDef.GlobalParamsPanel.ReExecute,c.Title=a.esPqDef.Title,c.Description=a.esPqDef.Description,j.all(i).then(function(b){var c=a.esPqDef.GlobalParamsPanel.Parameters;a.esUrlParams&&_.forEach(Object.keys(a.esUrlParams),function(b){var d=c.paramsValues[b];d&&d.pValue(a.esUrlParams[b])}),_.forEach(b,function(b){_.forEach(c.paramsValues,function(a){var c=b.Params[a.paramCode];c&&c.pValue(a.pValue())});var d=b.ParametersDefinition&&b.ParametersDefinition();d instanceof f.ESParamsDefinitions&&_.forEach(d.definitions,function(b){var c=_.find(a.esPqDef.GlobalParamsPanel.Parameters.definitions,{id:b.id});c&&(b.visible=!1)})});var d,e,h,i=20,j=g.getClientSession().getModel();j&&j.Claims&&j.Claims.ESApplicationID&&"espremanalyzer"==j.Claims.ESApplicationID||(a.esPqDef.GlobalParamsPanel.ReExecute=0),a.esPqDef.GlobalParamsPanel.ReExecute&&(e=a.esPqDef.GlobalParamsPanel.ReExecute*(60/i),a.globalTitle="Last Run - // NEXT Run in "+moment.duration(e*i,"seconds").humanize(),d=m(function(){e--,0==e&&(a.globalExecutePQ(),h=moment(),e=a.esPqDef.GlobalParamsPanel.ReExecute*(60/i)),a.globalTitle="Last Run "+(h?h.fromNow():" -")+" // Next Run in "+moment.duration(e*i,"seconds").humanize()},1e3*i),a.$on("$destroy",function(){d&&(m.cancel(d),d=null)})),a.esPqDef.GlobalParamsPanel.AutoExecute&&(a.globalExecutePQ(),a.esPqDef.GlobalParamsPanel.ReExecute&&(h=moment(),a.globalTitle="Last Run "+h.fromNow()+" // Next Run in "+moment.duration(e*i,"seconds").humanize()))})["catch"](function(a){console.log(a)})}a.esPqDef=c};a.Favourites=null,a.globalTitle=h.instant("ESUI.PARAMS_PANEL.TITLE");var w=function(){var b=j.defer();return a.Favourites?b.resolve(a.Favourites):loadFavourites(j,g,d,e,k).then(function(c){a.Favourites=c,b.resolve(a.Favourites)})["catch"](function(a){b.reject(a)}),b.promise};a.email=function(b){var c={ObjectID:"esanalyzer",KeyID:"eslink",IsNew:!0,TypeID:ESLINK_TYPEID,TextBody:JSON.stringify({ID:b.CtxID,Params:b.Params.getSerialized(),Title:b.Title})};e.postBodyToES00Blob(c).then(function(b){if(n&&n.supported){var c=b.data;a.esLinkPrefix&&a.esLinkPrefix.replace("{0}",b.data)!=a.esLinkPrefix&&(c=a.esLinkPrefix.replace("{0}",b.data));var d={id:"shortcut",title:h.instant("ESUI.FAV.LINK"),required:!0,inputType:"readonly",caption:h.instant("ESUI.FAV.PROMPT_LINK"),param:new g.ESParamVal("fav_link",c)};f.esAskForField(i,d).then(function(){n&&n.supported&&(n.copyText(c),a.showUserMessage(h.instant("ESUI.FAV.COPY_CLIPBOARD_OK")))})["catch"](function(a){e.removeEntityBlob({GID:b.data})["catch"](function(){})})}})["catch"](function(a){t(a)})},a.addRemoveFav=function(b,c){if(c){var j={id:"shortcut",title:h.instant("ESUI.FAV.ADD"),required:!0,caption:h.instant("ESUI.FAV.PROMPT_TITLE"),param:new g.ESParamVal("fav_title","")};f.esAskForField(i,j).then(function(){w().then(function(c){var f=c.addRemoveFav(g,d,e,b,j.param.pValue());f&&f.then(function(b){a.showUserMessage(h.instant("ESUI.FAV.SAVE_SUCCESS"))})["catch"](function(a){t(a)})})["catch"](function(a){t(a)})})["catch"](function(a){"cancel"!=a&&t(a)})}else{var k=u(b);if(-1==k)return;w().then(function(c){var f=c.addRemoveFav(g,d,e,b,"",k);f&&f.then(function(b){a.esPqDef.splice(k,1),a.showUserMessage(h.instant("ESUI.FAV.SAVE_SUCCESS"))})["catch"](function(a){t(a)})})["catch"](function(a){t(a)})}},a.clearAll=function(){confirm(h.instant("ESUI.FAV.CONFIRM_CLEAR"))&&w().then(function(b){b.clearAll(g,e).then(function(b){a.esPqDef=[],a.showUserMessage(h.instant("ESUI.FAV.SAVE_SUCCESS"))})["catch"](function(a){t(a)})})["catch"](function(a){t(a)})},a.moveUpOrDown=function(b,c){var f=u(b);-1!=f&&a.canMoveUpOrDown(b,c)&&w(j,g,d,e).then(function(b){var d=b.moveUpOrDown(g,e,f,c);d&&d.promise.then(function(){var b=a.esPqDef[d.to];a.esPqDef[d.to]=a.esPqDef[d.from],a.esPqDef[d.from]=b,a.showUserMessage(h.instant("ESUI.FAV.SAVE_SUCCESS"))})["catch"](function(a){t(a)})})["catch"](function(a){t(a)})},a.canMoveUpOrDown=function(b,c){var d=u(b);return-1==d?!1:c?0!=d:d<a.esPqDef.length-1},v()}]).directive("esComboPq",["$log","esWebApi","esMessaging","esUIHelper","esGlobals",function(a,b,c,d,e){return{restrict:"AE",scope:{esPqDef:"=",esInApp:"=?",esUrlParams:"=?",isFavouritesMode:"=?",esLinkPrefix:"=?",esSimpleMode:"=?",esShowUserMessage:"&"},templateUrl:function(a,b){return"src/partials/esComboPQ.html"}}}]).directive("esGrid",["$log","esWebApi","esMessaging","esUIHelper","esGlobals",function(a,b,c,d,e){return{restrict:"AE",scope:{esGroupId:"=",esFilterId:"=",esExecuteParams:"=",esGridOptions:"=?",esPostGridOptions:"=?",esPQOptions:"=?",esDataSource:"=?"},templateUrl:function(a,b){return"src/partials/esGrid.html"},link:function(a,c,e){if(a.esGridRun=function(){a.$parent&&a.$parent.esPanelOpen&&(a.$parent.esPanelOpen.status=!1),a.esGridOptions&&a.esGridOptions.dataSource&&(a.esPQOptions&&!a.esPQOptions.ServerPaging?(a.esGridOptions.dataSource.read(),a.esGridOptions.dataSource.page(1)):a.esGridOptions.dataSource.page(1))},a.$watch("esGridOptions",function(b,c){if(b&&b.esToolbars&&angular.isArray(b.esToolbars)){b.toolbar||[];_.forEach(b.esToolbars,function(b){b.fnName&&b.fnDef&&angular.isFunction(b.fnDef)&&(a[b.fnName]=b.fnDef)})}}),a.esGridPrint=function(){},!a.esGridOptions&&!e.esGridOptions){if(!a.esGroupId||!a.esFilterId)throw"esGridOptions NOT defined. In order to dynamically get the options you must set GroupID and FilterID for esgrid to work";b.fetchPublicQueryInfo(a.esGroupId,a.esFilterId,!0,!0).then(function(b){var c=b.data,e=d.winGridInfoToESGridInfo(a.esGroupId,a.esFilterId,c);a.esGridOptions=d.esGridInfoToKInfo(a.esGroupId,a.esFilterId,a.esExecuteParams,e,a.esPQOptions),a.esPostGridOptions&&angular.merge(a.esGridOptions,a.esPostGridOptions)})["catch"](angular.noop)}}}}]).directive("esGaugePq",["$log","$window","esWebApi","esMessaging","esUIHelper","esGlobals","$timeout",function(a,b,c,d,e,f,g){return{restrict:"AE",scope:{esPqDef:"="},templateUrl:function(a,b){return"src/partials/esGaugePQ.html"},link:function(a,b,d){function e(){function b(b,c,d,e){b.esScaleOptions={min:c,max:d,ranges:e,labels:a.esPqDef.UIOptions.labels,vertical:!!a.esPqDef.UIOptions.vertical};var f,g=angular.isArray(a.esPqDef.UIOptions.pointer)?a.esPqDef.UIOptions.pointer:[a.esPqDef.UIOptions.pointer],h=[];for(f=0;f<g.length;f++){var i=angular.merge({},g[f]);i.value=b["GValue"+(f+1)],h.push(i)}b.esPointer=h}function d(a,e){if(!(a>=e.length)){var g=e[a],h=0,i=100,j=[{from:0,to:100}];g.GScale?c.fetchESScale(g.GScale).then(function(c){var k=c;k&&k.Ranges&&k.Ranges.length&&(h=_.minBy(k.Ranges,"MinValue").MinValue,i=_.maxBy(k.Ranges,"MaxValue").MaxValue,j=_.map(k.Ranges,function(a){var b={from:a.MinValue,to:a.MaxValue};return a.ColorARGB&&(b.color=f.rgbToHex(a.ColorARGB)),b})),b(g,h,i,j),d(a+1,e)})["catch"](function(c){b(g,h,i,j),d(a+1,e)}):(b(g,h,i,j),d(a+1,e))}}a.esRows&&a.esRows.length&&a.esPqDef.UIOptions.pointer&&d(0,a.esRows)}a.executePQ=function(){c.fetchPublicQuery(a.esPqDef).then(function(b){b.data.Rows&&b.data.Rows.length&&(a.esRows=a.esPqDef.UIOptions.expandRows?b.data.Rows:[b.data.Rows[0]],e())})["catch"](angular.noop)},a.esPqDef.runPQ=a.executePQ,a.esPqDef&&a.esPqDef.PQOptions&&a.esPqDef.PQOptions.AutoExecute&&a.executePQ()}}}]).directive("esStockChart",["$log","$window","esWebApi","esMessaging","esUIHelper","esGlobals",function(a,b,c,d,e,f){return{restrict:"AE",scope:{esPanelOpen:"=?",esPqDef:"=?",esChartOptions:"=",esChartCtrl:"=?",esLocalData:"=?"},templateUrl:function(a,b){return"src/partials/esStockChartPQ.html"},link:function(a,c,d){var f=function(){return a.esChartCtrl},g=function(){var a=f();a?a.resize():kendo.resize(angular.element(".eschart-wrapper"))};if(a.esLocalData||d.esLocalData)a.esChartDataSource=angular.isArray(a.esLocalData)?{data:a.esLocalData}:a.esLocalData;else{var h=a.esChartOptions?a.esChartOptions.group:null;a.esChartDataSource=e.getPQDataSource(a.esPqDef,null,null,h,f)}a.esChartOptions.dataSource=a.esChartDataSource,a.executePQ=function(){a.esPanelOpen.status=!1,a.esChartDataSource&&a.esChartDataSource.read()},a.esPqDef&&(a.esPqDef.runPQ=a.executePQ),a.$on("$destroy",function(){angular.element(b).unbind("resize",g)}),angular.element(b).bind("resize",g)}}}]).directive("esChart",["$log","$window","esWebApi","esMessaging","esUIHelper","esGlobals",function(a,b,c,d,e,f){return{restrict:"AE",scope:{esPanelOpen:"=?",esPqDef:"=?",esChartOptions:"=",esChartCtrl:"=?",esLocalData:"=?"},templateUrl:function(a,b){return"src/partials/esChartPQ.html"},link:function(a,c,d){var f=function(){return a.esChartCtrl},g=function(){var a=f();a?a.resize():kendo.resize(angular.element(".eschart-wrapper"))};if(a.esLocalData||d.esLocalData)a.esChartDataSource={data:a.esLocalData};else{var h=a.esChartOptions?a.esChartOptions.group:null;a.esChartDataSource=e.getPQDataSource(a.esPqDef,null,null,h,f)}a.esChartOptions.dataSource=a.esChartDataSource,a.executePQ=function(){a.esPanelOpen.status=!1,a.esChartDataSource&&a.esChartDataSource.read()},a.esPqDef.runPQ=a.executePQ,a.$on("$destroy",function(){angular.element(b).unbind("resize",g)}),angular.element(b).bind("resize",g)}}}]).directive("esGanttPq",["$log","$window","esWebApi","esMessaging","esUIHelper","esGlobals","$translate",function(a,b,c,d,e,f,g){return{restrict:"AE",scope:{esPqDef:"=",esGanttCtrl:"=?"},templateUrl:function(a,b){return"src/partials/esGanttPQ.html"},link:function(d,e,h){var i=function(){return d.esGanttCtrl},j=function(){var a=i();a?a.resize():kendo.resize(angular.element(".eschart-wrapper"))};d.$on("$destroy",function(){angular.element(b).unbind("resize",j)}),angular.element(b).bind("resize",j),d.executePQ=function(){d.esPqDef.esPanelOpen.status=!1,d.tasksDS&&d.tasksDS.read()},d.esPqDef.runPQ=d.executePQ,d.tasksDS=new kendo.data.GanttDataSource({transport:{error:function(a){console.log(a)},read:function(b){var e={};e.WithCount=!1,e.Page=-1,e.PageSize=-1;var h=d.esPqDef.Params;if(h instanceof f.ESParamValues){if(!h.isValidState()){var i=new Error(g.instant("ESUI.PQ.PARAMS_MISSING"));throw b.error(i),i}h=h.getExecuteVals()}c.fetchPublicQuery(d.esPqDef.GroupID,d.esPqDef.FilterID,e,h).then(function(a){a=a&&a.data&&a.data.Rows&&a.data.Rows.length?a.data.Rows:[],b.success(a),d.resourcesDS.read()})["catch"](function(c){a.error("Error in DataSource ",c),b.error(c)})}},schema:{model:{id:"id",fields:{id:{from:"Code",type:"string"},parentId:{from:"ParentCode",type:"string"},TaskTypeDescription:{from:"TaskTypeDescription",type:"string"},WPCode:{from:"WPCode",type:"string"},start:{from:"StartDate",type:"date"},end:{from:"FinishDate",type:"date"},title:{from:"Title",type:"string"},percentComplete:{from:"Completeness",type:"number"},summary:{from:"IsSummary",type:"boolean"},expanded:{from:"Expanded",type:"boolean"}}}}}),d.resourcesDS=new kendo.data.DataSource({transport:{error:function(a){console.log(a)},read:function(b){var e={};e.WithCount=!1,e.Page=-1,e.PageSize=-1;var h=d.esPqDef.Params;if(h instanceof f.ESParamValues){if(!h.isValidState()){var i=new Error(g.instant("ESUI.PQ.PARAMS_MISSING"));throw b.error(i),i}h=h.getExecuteVals()}var j=d.esPqDef.GroupID,k="ProjectTaskResources";if(d.esPqDef.UIOptions&&angular.isString(d.esPqDef.UIOptions.ProjectTaskResourcesPQ)){var l=d.esPqDef.UIOptions.ProjectTaskAssignmentsPQ.split(",");l[0]=l[0].trim(),l[0]&&(j=l[0]),l.length>1&&(l[1]=l[1].trim(),l[1]&&(k=l[1]))}c.fetchPublicQuery(j,k,e,h).then(function(a){a=a&&a.data&&a.data.Rows&&a.data.Rows.length?a.data.Rows:[],b.success(a),d.assignmentsDS.read()})["catch"](function(c){a.error("Error in DataSource ",c),b.error(c)})}},schema:{model:{id:"id",fields:{id:{from:"Code",type:"string"},Name:{from:"Name",type:"string"},Color:{from:"Color",type:"string"}}}}}),d.assignmentsDS=new kendo.data.DataSource({transport:{error:function(a){console.log(a)},read:function(b){var e={};e.WithCount=!1,e.Page=-1,e.PageSize=-1;var h=d.esPqDef.Params;if(h instanceof f.ESParamValues){if(!h.isValidState()){var i=new Error(g.instant("ESUI.PQ.PARAMS_MISSING"));throw b.error(i),i}h=h.getExecuteVals()}var j=d.esPqDef.GroupID,k="ProjectTaskAssignments";if(d.esPqDef.UIOptions&&angular.isString(d.esPqDef.UIOptions.ProjectTaskAssignmentsPQ)){var l=d.esPqDef.UIOptions.ProjectTaskAssignmentsPQ.split(",");l[0]=l[0].trim(),l[0]&&(j=l[0]),l.length>1&&(l[1]=l[1].trim(),l[1]&&(k=l[1]))}c.fetchPublicQuery(j,k,e,h).then(function(a){a=a&&a.data&&a.data.Rows&&a.data.Rows.length?a.data.Rows:[],b.success(a)})["catch"](function(c){a.error("Error in DataSource ",c),b.error(c)})}},schema:{model:{id:"ID",fields:{ID:{from:"GID",type:"string"},ResourceID:{from:"Code",type:"string"},Units:{from:"ResourceUsage",type:"number"},TaskID:{from:"TaskCode",type:"string"}}}}}),d.esGanttOptions={toolbar:[{name:"pdf"}],dataSource:d.tasksDS,assignments:{dataTaskIdField:"TaskID",dataResourceIdField:"ResourceID",dataValueField:"Units",dataSource:d.assignmentsDS},resources:{field:"Resources",dataColorField:"Color",dataTextField:"Name",dataSource:d.resourcesDS},views:["day",{type:"week",dayHeaderTemplate:kendo.template("#=kendo.toString(start, 'ddd d/M')#"),weekHeaderTemplate:"#=kendo.toString(start, 'dddd d/M')# - #=kendo.toString(kendo.date.addDays(end, -1), 'dddd d/M')#",selected:!0},{type:"month",weekHeaderTemplate:"#=kendo.toString(start, 'ddd d/M')# - #=kendo.toString(kendo.date.addDays(end, -1), 'ddd d/M')#",monthHeaderTemplate:"#=kendo.toString(start, 'MMMM yyyy')#"}],columns:[{field:"title",title:g.instant("ESUI.PROJECT.COL_TITLE"),width:200},{field:"start",title:g.instant("ESUI.PROJECT.START_TITLE"),format:"{0:dd/MM/yyyy}",width:100},{field:"end",title:g.instant("ESUI.PROJECT.END_TITLE"),format:"{0:dd/MM/yyyy}",width:100},{field:"Resources",title:g.instant("ESUI.PROJECT.RES_TITLE"),width:400},{field:"id",title:g.instant("ESUI.PROJECT.ID_TITLE"),width:100},{field:"TaskTypeDescription",title:g.instant("ESUI.PROJECT.TTYPE_TITLE"),width:200},{field:"WPCode",title:g.instant("ESUI.PROJECT.WP_TITLE"),width:100,defaultValue:""}],height:800,autoBind:!1,resizable:!0,columnResizeHandleWidth:6,navigatable:!0,showWorkHours:!1,showWorkDays:!1},d.esPqDef&&d.esPqDef.PQOptions&&d.esPqDef.PQOptions.AutoExecute&&d.executePQ()}}}]).directive("esTimelinePq",["$log","$window","$timeout","esWebApi","esMessaging","esUIHelper","esGlobals","$translate",function(a,b,c,d,e,f,g,h){return{restrict:"AE",scope:{esPqDef:"=",esTimelineCtrl:"=?"},templateUrl:function(a,b){return"src/partials/esTimelinePQ.html"},link:function(c,e,f){var i=function(){return c.esTimelineCtrl},j=function(){var a=i();a?a.resize():kendo.resize(angular.element(".estimeline-wrapper"))};c.$on("$destroy",function(){angular.element(b).unbind("resize",j)}),angular.element(b).bind("resize",j),c.entityDS={},c.executePQ=function(){c.esPqDef.esPanelOpen.status=!1,c.esTimelineCtrl&&c.esTimelineCtrl.setDataSource(k())},c.esPqDef.runPQ=c.executePQ,c.getImageUrl=function(a){return esResolveBlobUrl(a,d)},c.toHeaderDateString=function(a){return a instanceof Date?kendo.toString(a,"d MMM yyyy"):kendo.toString(new Date(a),"d MMM yyyy")};var k=function(){return new kendo.data.DataSource({transport:{error:function(a){console.log(a)},read:function(b){var e={};e.WithCount=!1,e.Page=-1,e.PageSize=-1;var f=c.esPqDef.Params;if(f instanceof g.ESParamValues){if(!f.isValidState()){var i=new Error(h.instant("ESUI.PQ.PARAMS_MISSING"));throw b.error(i),i}f=f.getExecuteVals()}d.fetchPublicQuery(c.esPqDef.GroupID,c.esPqDef.FilterID,e,f).then(function(a){a=a&&a.data&&a.data.Rows&&a.data.Rows.length?a.data.Rows:[],c.timelineDS=a,c.oldestEvent=a.length>0?a.reduce(function(a,b){return a.Date<b.Date?a:b}):null,c.newestEvent=a.length>0?a.reduce(function(a,b){return a.Date>b.Date?a:b}):null;var g=c.esPqDef.GroupID,h="TimelineBusinessAccountInfo";if(c.esPqDef.UIOptions&&angular.isString(c.esPqDef.UIOptions.TimelineEntityInfoPQ)){var i=c.esPqDef.UIOptions.TimelineEntityInfoPQ.split(",");i[0]=i[0].trim(),i[0]&&(g=i[0]),i.length>1&&(i[1]=i[1].trim(),i[1]&&(h=i[1]))}d.fetchPublicQuery(g,h,e,f).then(function(a){a&&a.data&&a.data.Rows&&a.data.Rows.length?c.entityDS=a.data.Rows[0]:c.entityDS={}})["catch"](function(a){c.entityDS={}}),b.success(a)})["catch"](function(d){a.error("Error in DataSource ",d),c.entityDS={},b.error(d)})}},serverSorting:!0,serverFiltering:!1,schema:{model:{fields:{date:{from:"Date",type:"date"},title:{from:"Title",type:"string"},titleAmount:{from:"TitleAmount",type:"number"},priority:{from:"Priority",type:"number"},latitude:{from:"Latitude",type:"number"},longitude:{from:"Longitude",type:"number"},qualifier:{from:"Qualifier",type:"number"},subtitle:{from:"SubTitle",type:"string"},description:{from:"Body",type:"string"},additionalInfo:{from:"AdditionalInfo",type:"string"},formid:{from:"FormID",type:"string"},fGID:{from:"fGID",type:"string"}}}}})},l={orientation:"vertical",alternatingMode:!0,collapsibleEvents:!0,dateFormat:"dddd, d MMM yyyy",eventTemplate:'<div class="timeline-event-container" data-priority="#= data.priority #">   <div class="k-card-header">       <h5 class="k-card-title" title="#= data.title #">           <span class="k-event-title"><i class="mdi mdi-#= ["help-circle", "calendar-check", "email", "emoticon-sad-outline", "telescope", "file-document-box-check-outline", "receipt", "truck", "file-document-box-minus-outline", "cash-multiple"][data.qualifier <= 8 ? data.qualifier + 1 : 0] #"></i> #= data.title #</span>           <span class="k-event-collapse k-button k-button-icon k-flat"><span class="k-icon k-i-arrow-chevron-right"></span></span>       </h5>       <h6 class="k-card-subtitle"><span>#= data.subtitle #</span><span class="amount">#= data.titleAmount ? kendo.toString(data.titleAmount, "c") : data.date && (data.date.getHours() + data.date.getMinutes() > 0) ? kendo.toString(data.date, "HH:mm") : "" #</span></h6>           # if (data.additionalInfo) { #           <h6 class="k-card-subtitle">#= data.additionalInfo #</h6>           # } #   </div>   <div class="k-card-body">       # if (data.description) { #       <div class="k-card-description">           # if (data.description) { #           <p>#= data.description #</p>           # } #       </div>       # } #       # if (data.images && data.images.length > 0) { #       <div class="images-container">           # for (var i = 0 ; i < data.images.length ; i++) { #           <img src="#= data.images[i].src #" class="k-card-image">           # } #       </div>       # } #       # if (data.latitude && data.longitude) { #       <div class="map-container"></div>       # } #   </div>   # if (data.actions && data.actions.length > 0) { #   <div class="k-card-actions">       # for (var i = 0 ; i < data.actions.length ; i++) { #       <a class="k-button k-flat k-primary" href="javascript:;">#= data.actions[i].text #</a>       # } #   </div>   # } #</div>',dataBound:function(a){$(".timeline-event-container").each(function(){var a=$(this);a.closest(".k-timeline-event").addClass("k-timeline-event-priority-"+(a.data("priority")||0)),""===$.trim(a.find(".k-card-body").html())&&a.addClass("timeline-event-container-nobody")})},expand:function(a){var b=$('.k-timeline-event[data-uid="'+a.dataItem.uid+'"] .timeline-event-container'),c=b.find(".map-container");null!=a.dataItem.latitude&&null!=a.dataItem.longitude&&null==c.data("kendoMap")&&c.kendoMap({layers:[{type:"tile",urlTemplate:"http://a.tile.openstreetmap.org/#= zoom #/#= x #/#= y #.png",attribution:"&copy; OpenStreetMap"}],center:[a.dataItem.latitude,a.dataItem.longitude],zoom:15,markers:[{location:[a.dataItem.latitude,a.dataItem.longitude]}]})}};c.esPqDef&&c.esPqDef.PQOptions&&c.esPqDef.PQOptions.AutoExecute&&(l.dataSource=k()),c.esTimelineOptions=l}}}]).directive("esCalendarPq",["$log","$window","esWebApi","esMessaging","esUIHelper","esGlobals","$translate",function(a,b,c,d,e,f,g){return{restrict:"AE",scope:{esPqDef:"=",esCalendarCtrl:"=?"},templateUrl:function(a,b){return"src/partials/esGanttPQ.html"},link:function(d,e,h){var i=function(){return d.esGanttCtrl},j=function(){var a=i();a?a.resize():kendo.resize(angular.element(".escalendar-wrapper"))};d.$on("$destroy",function(){angular.element(b).unbind("resize",j)}),angular.element(b).bind("resize",j),d.executePQ=function(){d.esPqDef.esPanelOpen.status=!1,d.tasksDS&&d.tasksDS.read()},d.esPqDef.runPQ=d.executePQ,d.tasksDS=new kendo.data.GanttDataSource({transport:{error:function(a){console.log(a)},read:function(b){var e={};e.WithCount=!1,e.Page=-1,e.PageSize=-1;var h=d.esPqDef.Params;if(h instanceof f.ESParamValues){if(!h.isValidState()){var i=new Error(g.instant("ESUI.PQ.PARAMS_MISSING"));throw b.error(i),i}h=h.getExecuteVals()}c.fetchPublicQuery(d.esPqDef.GroupID,d.esPqDef.FilterID,e,h).then(function(a){a=a&&a.data&&a.data.Rows&&a.data.Rows.length?a.data.Rows:[],b.success(a),d.resourcesDS.read()})["catch"](function(c){a.error("Error in DataSource ",c),b.error(c)})}},schema:{model:{id:"id",fields:{id:{from:"Code",type:"string"},parentId:{from:"ParentCode",type:"string"},TaskTypeDescription:{from:"TaskTypeDescription",type:"string"},WPCode:{from:"WPCode",type:"string"},start:{from:"StartDate",type:"date"},end:{from:"FinishDate",type:"date"},title:{from:"Title",type:"string"},percentComplete:{from:"Completeness",type:"number"},summary:{from:"IsSummary",type:"boolean"},expanded:{from:"Expanded",type:"boolean"}}}}}),d.resourcesDS=new kendo.data.DataSource({transport:{error:function(a){console.log(a)},read:function(b){var e={};e.WithCount=!1,e.Page=-1,e.PageSize=-1;var h=d.esPqDef.Params;if(h instanceof f.ESParamValues){if(!h.isValidState()){var i=new Error(g.instant("ESUI.PQ.PARAMS_MISSING"));throw b.error(i),i}h=h.getExecuteVals()}var j=d.esPqDef.GroupID,k="ProjectTaskResources";if(d.esPqDef.UIOptions&&angular.isString(d.esPqDef.UIOptions.ProjectTaskResourcesPQ)){var l=d.esPqDef.UIOptions.ProjectTaskAssignmentsPQ.split(",");l[0]=l[0].trim(),l[0]&&(j=l[0]),l.length>1&&(l[1]=l[1].trim(),l[1]&&(k=l[1]))}c.fetchPublicQuery(j,k,e,h).then(function(a){a=a&&a.data&&a.data.Rows&&a.data.Rows.length?a.data.Rows:[],b.success(a),d.assignmentsDS.read()})["catch"](function(c){a.error("Error in DataSource ",c),b.error(c)})}},schema:{model:{id:"id",fields:{id:{from:"Code",type:"string"},Name:{from:"Name",type:"string"},Color:{from:"Color",type:"string"}}}}}),d.assignmentsDS=new kendo.data.DataSource({transport:{error:function(a){console.log(a)},read:function(b){var e={};e.WithCount=!1,e.Page=-1,e.PageSize=-1;var h=d.esPqDef.Params;if(h instanceof f.ESParamValues){if(!h.isValidState()){var i=new Error(g.instant("ESUI.PQ.PARAMS_MISSING"));throw b.error(i),i}h=h.getExecuteVals()}var j=d.esPqDef.GroupID,k="ProjectTaskAssignments";if(d.esPqDef.UIOptions&&angular.isString(d.esPqDef.UIOptions.ProjectTaskAssignmentsPQ)){var l=d.esPqDef.UIOptions.ProjectTaskAssignmentsPQ.split(",");l[0]=l[0].trim(),l[0]&&(j=l[0]),l.length>1&&(l[1]=l[1].trim(),l[1]&&(k=l[1]))}c.fetchPublicQuery(j,k,e,h).then(function(a){a=a&&a.data&&a.data.Rows&&a.data.Rows.length?a.data.Rows:[],b.success(a)})["catch"](function(c){a.error("Error in DataSource ",c),b.error(c)})}},schema:{model:{id:"ID",fields:{ID:{from:"GID",type:"string"},ResourceID:{from:"Code",type:"string"},Units:{from:"ResourceUsage",type:"number"},TaskID:{from:"TaskCode",type:"string"}}}}}),d.esGanttOptions={dataSource:d.tasksDS,assignments:{dataTaskIdField:"TaskID",dataResourceIdField:"ResourceID",dataValueField:"Units",dataSource:d.assignmentsDS},resources:{field:"Resources",dataColorField:"Color",dataTextField:"Name",dataSource:d.resourcesDS},views:["day",{type:"week",selected:!0},"month"],columns:[{field:"title",title:g.instant("ESUI.PROJECT.COL_TITLE"),width:200},{field:"start",title:g.instant("ESUI.PROJECT.START_TITLE"),format:"{0:dd/MM/yyyy}",width:100},{field:"end",title:g.instant("ESUI.PROJECT.END_TITLE"),format:"{0:dd/MM/yyyy}",width:100},{field:"Resources",title:g.instant("ESUI.PROJECT.RES_TITLE"),width:400},{field:"id",title:g.instant("ESUI.PROJECT.ID_TITLE"),width:100},{field:"TaskTypeDescription",title:g.instant("ESUI.PROJECT.TTYPE_TITLE"),width:200},{field:"WPCode",title:g.instant("ESUI.PROJECT.WP_TITLE"),width:100,defaultValue:""}],height:800,autoBind:!1,resizable:!0,columnResizeHandleWidth:6,navigatable:!0,showWorkHours:!1,showWorkDays:!1},d.esPqDef&&d.esPqDef.PQOptions&&d.esPqDef.PQOptions.AutoExecute&&d.executePQ()}}}]).directive("esSanKeyPq",["$log","$window","$uibModal","$timeout","esWebApi","esMessaging","esUIHelper","esGlobals",function(a,b,c,d,e,f,g,h){return{restrict:"AE",scope:{esPqDef:"="},templateUrl:function(a,b){return"src/partials/esSanKeyPQ.html"},link:{pre:function(c,d,h){c.executePQ=function(){c.esPqDef.esPanelOpen.status=!1,c.sankeyCtrl&&c.sankeyCtrl.showLoadingIndicator(),e.fetchPublicQuery(c.esPqDef).then(function(a){var b=a.data.Rows;c.UIOptions.dataSource.length=0;var d=0;for(d=0;d<b.length;d++)c.UIOptions.dataSource.push(b[d]);c.sankeyCtrl&&(c.sankeyCtrl.getDataSource().reload(),c.sankeyCtrl.hideLoadingIndicator())})["catch"](function(a){c.UIOptions.dataSource.length=0,c.sankeyCtrl&&(c.sankeyCtrl.getDataSource().reload(),c.sankeyCtrl.hideLoadingIndicator())})};var i={dataSource:[],sourceField:"FromDimension",targetField:"ToDimension",weightField:"Weight",link:{colorMode:"gradient"},onInitialized:function(a){c.sankeyCtrl=a.component},onIncidentOccurred:function(a){a.target&&"error"==a.target.type&&f.publish("ES_SANKEY_INCIDENT_OCCURED",a)},tooltip:{enabled:!0}},j=c.esPqDef.UIOptions;j&&angular.merge(i,j),c.UIOptions=i,c.esPqDef.runPQ=c.executePQ,c.$on("$destroy",function(){
angular.element(b).unbind("resize",k)});var k=function(){c.sankeyCtrl&&c.sankeyCtrl.render()};angular.element(b).bind("resize",k),e.fetchPublicQueryInfo(c.esPqDef).then(function(a){var b=g.winGridInfoToESGridInfo(c.esPqDef.GroupID,c.esPqDef.FilterID,a.data),d={enabled:!0,customizeLinkTooltip:function(a){var d="<b>"+_.find(b.columns,{field:c.UIOptions.sourceField}).title+":</b> "+a.source+"<br/><b>"+_.find(b.columns,{field:c.UIOptions.targetField}).title+":</b> "+a.target+"<br/><b>"+_.find(b.columns,{field:c.UIOptions.weightField}).title+":</b> "+a.weight;return{html:d}}};c.sankeyCtrl&&(c.sankeyCtrl.option("tooltip",d),c.sankeyCtrl.option("title",b.caption))})["catch"](function(b){a.error(b)}),c.esPqDef&&c.esPqDef.PQOptions&&c.esPqDef.PQOptions.AutoExecute&&c.executePQ()}}}}]).directive("esCardPq",["$log","$window","$uibModal","$timeout","esWebApi","esMessaging","esUIHelper","esGlobals",function(a,b,c,d,e,f,g,h){return{restrict:"AE",scope:{esPqDef:"="},templateUrl:function(a,b){return"src/partials/esCardPQ.html"},link:function(a,b,d){a.executePQ=function(){a.esPqDef.esPanelOpen.status=!1,a.cardDataSource.page(1)},a.esPqDef.runPQ=a.executePQ;var f={headerField:"",titleField:"",footerField:"",imageField:"",tagField:"",simpleView:!1},i=a.esPqDef.UIOptions;i&&angular.merge(f,i),a.UIOptions=f;var j={serverGrouping:!1,serverSorting:!1,serverFiltering:!1,serverAggregates:!1,serverPaging:a.esPqDef.PQOptions&&angular.isDefined(a.esPqDef.PQOptions.ServerPaging)?a.esPqDef.PQOptions.ServerPaging:!0,pageSize:(a.esPqDef.PQOptions?a.esPqDef.PQOptionsPageSize:null)||20};a.cardDataSource=g.getPQDataSource(a.esPqDef,j);var k=null;a.bodyFields=function(){if(console.log("BF - "+(k?k.length:" NULL ")),k)return k;var b=[a.UIOptions.headerField,a.UIOptions.titleField,a.UIOptions.footerField,a.UIOptions.imageField,a.UIOptions.tagField,"Longitude","Latitude"];return a.esPqDef.esGridOptions&&a.esPqDef.esGridOptions.columns?k=_.filter(a.esPqDef.esGridOptions.columns,function(a){return-1==b.indexOf(a.field)}):[]},a.getTagField=function(b){if(a.UIOptions.tagField){var c=b[a.UIOptions.tagField];if(c)return c}return"none"},a.isNoImage=function(b){return!a.getImageUrl(b)},a.getImageUrl=function(b){return a.UIOptions.imageField?esResolveBlobUrl(b[a.UIOptions.imageField],e):null},a.getFieldText=function(a,b){var c=b.field;return a[c]?h.isEmail(c)?'<a href="mailto:'+a[c]+'">'+a[c]+"</a>":h.isPhone(c)?'<a href="tel:'+a[c]+'">'+a[c]+"</a>":b.format?kendo.format(b.format,a[c]):a[c]:null},a.getFieldStyle=function(a,b){var c=a[b.field];return c&&0>c?{color:"red"}:null},a.hasMap=function(a){return a.Latitude&&a.Longitude},a.showMap=function(b){if(a.hasMap(b)){var d=c.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",template:"<div ng-include src=\"'src/partials/esmodalmap.html'\"></div>",size:"lg",controller:function(){var c=this;c.point=[b.Latitude,b.Longitude],c.title=(a.UIOptions.headerField?b[a.UIOptions.headerField]:"")+" - "+(a.UIOptions.titleField?b[a.UIOptions.titleField]:"")||b[0]},controllerAs:"$ctrl"});d.result.then(function(a){})["catch"](angular.noop)}},a.esPqDef&&a.esPqDef.PQOptions&&a.esPqDef.PQOptions.AutoExecute&&a.executePQ()}}}]).directive("esMetricPq",["$log","$window","$uibModal","$timeout","esWebApi","esMessaging","esUIHelper","esGlobals",function(a,b,c,d,e,f,g,h){return{restrict:"AE",scope:{esPqDef:"="},templateUrl:function(a,b){return"src/partials/esMetricPQ.html"},link:function(a,b,c){a.executePQ=function(){a.esPqDef.esPanelOpen.status=!1,a.metricDataSource.page(1)},a.esPqDef.runPQ=a.executePQ;var d={titleField:"",valueField:"",tagField:"",iconField:""},e=a.esPqDef.UIOptions;e&&angular.merge(d,e),a.UIOptions=d;var f={serverGrouping:!1,serverSorting:!1,serverFiltering:!1,serverAggregates:!1,serverPaging:!0,pageSize:100};a.metricDataSource=g.getPQDataSource(a.esPqDef,f),a.getValue=function(b){var c=b[a.UIOptions.valueField];return a.UIOptions.formatValue?kendo.format(a.UIOptions.formatValue,c):c},a.getTagField=function(b){if(a.UIOptions.tagField){var c=b[a.UIOptions.tagField];if(c)return c}return"none"},a.esPqDef&&a.esPqDef.PQOptions&&a.esPqDef.PQOptions.AutoExecute&&a.executePQ()}}}]).directive("esTreeMap",["$log","$window","esWebApi","esMessaging","esUIHelper","esGlobals",function(a,b,c,d,e,f){return{restrict:"AE",scope:{esPanelOpen:"=?",esPqDef:"=?",esChartCtrl:"=?",esChartOptions:"=?"},templateUrl:function(a,b){return"src/partials/esTreeMapPQ.html"},link:function(a,c,d){var f=function(){return a.esTreeMapCtrl},g=function(){var a=f();a?a.resize():kendo.resize(angular.element(".eschart-wrapper"))};a.esChartDataSource=e.getTreeMapDS(a.esPqDef,!1,null,f);var h=a.esChartOptions||{};h.valueField="value",h.textField="name",a.executePQ=function(){a.esPqDef.esPanelOpen.status=!1,a.esChartDataSource&&a.esChartDataSource.read()},a.esPqDef.runPQ=a.executePQ,a.$on("$destroy",function(){angular.element(b).unbind("resize",g)}),angular.element(b).bind("resize",g),h.dataSource=a.esChartDataSource}}}]).directive("esPivotPq",["$log","$window","$q","esWebApi","esMessaging","esUIHelper","esGlobals","esCache",function(a,b,c,d,e,f,g,h){return{restrict:"AE",scope:{esPqDef:"=",esPanelOpen:"=?"},templateUrl:function(a,b){return"src/partials/esPivotPQ.html"},link:{pre:function(b,e,i){var j=!1;g.getESUISettings();if(!b.esPqDef||!b.esPqDef.UIOptions||!b.esPqDef.UIOptions.cubeDef)throw"espivotpq directive is either missing esPqDef or esPqDef.UIOptions or esPqDef.UIOptions.cubeDef";var k={allowSortingBySummary:!0,allowSorting:!0,allowFiltering:!0,allowExpandAll:!0,showBorders:!0,rowHeaderLayout:"tree",fieldChooser:{enabled:!0},"export":{enabled:!0},fieldPanel:{showDataFields:!0,showRowFields:!0,showColumnFields:!0,showFilterFields:!0,allowFieldDragging:!0,visible:!1}};b.chartOptions={commonSeriesSettings:{type:"bar"},tooltip:{enabled:!0,customizeTooltip:function(a){var b=h.getItem("ES_BASE_CURR"),c="";if(b)try{c=Globalize.formatCurrency(a.originalValue,b)}catch(d){c=a.valueText}else c=a.valueText;return{html:a.seriesName+"<div class='currency'>"+c+"</div>"}}},onInitialized:function(a){b.pivotChart=a.component,!j&&b.gridInstance&&(b.gridInstance.bindChart(b.pivotChart,{dataFieldsDisplayMode:"splitPanes",alternateDataFields:!1}),j=!0)}};var l=k;if(b.esPqDef.UIOptions.pivotOptions){var m=angular.merge({},l,b.esPqDef.UIOptions.pivotOptions);angular.merge(l,m)}l.onContextMenuPreparing=function(a){var c=a.field,d=a.component.getDataSource();if(c){if("number"===c.dataType){var e=function(a){d.field(c.index,{summaryType:a.itemData.value}),d.load()},f=[];a.items.splice(0,0,{text:"Summary Type",beginGroup:!0,items:f}),_.forEach(["Sum","Avg","Min","Max"],function(b){var c=b.toLowerCase();f.push({text:b,value:b.toLowerCase(),onItemClick:e,selected:a.field.summaryType===c})})}}else{var g=b.gridInstance.option("rowHeaderLayout"),h="standard"==g?"tree":"standard";a.items.splice(0,0,{beginGroup:!0,text:"RowHeader Layout "+h,onItemClick:function(a){b.gridInstance.option("rowHeaderLayout",h)}});var i=b.gridInstance.option("showTotalsPrior"),j="both"==i?"none":"both";a.items.splice(1,0,{beginGroup:!0,text:"Show Totals "+j,onItemClick:function(a){b.gridInstance.option("showTotalsPrior",j)}});var k=b.gridInstance.option("dataFieldArea"),l="row"==k?"column":"row";a.items.splice(2,0,{beginGroup:!0,text:"Data Field headers in "+l,onItemClick:function(a){b.gridInstance.option("dataFieldArea",l)}}),b.esPqDef.UIOptions.enableChart&&a.items.push({beginGroup:!0,text:b.esPqDef.UIOptions.hideChart?"Show Chart":"Hide Chart",onItemClick:function(a){b.esPqDef.UIOptions.hideChart=!b.esPqDef.UIOptions.hideChart}})}},l.onCellClick=function(a){if("data"==a.area){var c=a.component.getDataSource(),d=a.cell.rowPath.join("/")+" - "+a.cell.columnPath.join("/")+" : "+a.dataFields[a.cell.dataIndex].caption;b.drillDownDataSource=c.createDrillDownDataSource(a.cell),b.salesPopupTitle=d,b.salesPopupVisible=!0}},l.onInitialized=function(a){b.gridInstance=a.component,b.pivotChart&&!j&&(b.gridInstance.bindChart(b.pivotChart,{dataFieldsDisplayMode:"splitPanes",alternateDataFields:!1}),j=!0)};var n=DevExpress.devices.current();(n.tablet||n.phone)&&(l.rowHeaderLayout="tree"),DevExpress.viz.currentTheme(n,"light"),b.pivotOptions=l,d.fetchPublicQueryInfo(b.esPqDef,null,!0,!0).then(function(a){var e=f.winGridInfoToESGridInfo(b.esPqDef.GroupID,b.esPqDef.FilterID,a.data);l["export"]&&(l["export"].fileName=e.caption,l["export"].proxyURL=d.proxyExportSaveFile("telerik")),b.dataGridOptions={columnAutoWidth:!0,rowAlternationEnabled:!0,filterRow:{visible:!0,applyFilter:"auto"},height:"100%",paging:{enabled:!0,pageSize:20,pageIndex:1},bindingOptions:{dataSource:{dataPath:"drillDownDataSource",deep:!1}},columns:_.map(_.filter(e.columns,function(a){return!a.hidden}),function(a){return{dataField:a.field,caption:a.title,allowSorting:!0,allowFiltering:!0,format:getPivotColFormatType(a)}})},b.popupOptions={showCloseButton:!0,bindingOptions:{title:"salesPopupTitle",visible:"salesPopupVisible"}},b.esPivotDataSource=f.getPivotDS(c,b.esPqDef,b.esPqDef.UIOptions.cubeDef,e),b.esPqDef.PQOptions&&b.esPqDef.PQOptions.AutoExecute&&b.gridInstance.option("dataSource",b.esPivotDataSource)})["catch"](function(b){a.error(b)}),b.executePQ=function(){b.esPqDef.esPanelOpen.status=!1,b.gridInstance.option("dataSource")?b.esPivotDataSource.reload():b.gridInstance.option("dataSource",b.esPivotDataSource)},b.esPqDef.runPQ=b.executePQ}}}}]).directive("esMapPq",["$log","$window","esWebApi","esMessaging","esUIHelper","esGlobals",function(a,b,c,d,e,f){return{restrict:"AE",scope:{esPanelOpen:"=?",esPqDef:"=?",esOptions:"=?"},templateUrl:function(a,b){return"src/partials/esMapPQ.html"},link:function(a,c,d){var f=function(b){var c=a.esMapCtrl;if(c){b.items&&b.items.length||(c.center([32.546813173515126,-4.218749999999986]),c.zoom(2));for(var d,e=0;e<b.items.length;e++){var f=[b.items[e].Latitude||b.items[e].latitude,b.items[e].Longitude||b.items[e].longitude];d?d.include(f):d=new kendo.dataviz.map.Extent(f,f)}c.extent(d)}},g=function(){return a.esMapCtrl},h=function(){var a=g();a?a.resize():kendo.resize(angular.element(".eschart-wrapper"))};a.bubbleMessage="",a.tlOptions={filter:"circle",content:function(){return a.bubbleMessage},position:"top",animation:{open:{effects:"zoom",duration:150}}};var i=a.esOptions||{},j=i.valueField&&angular.isString(i.valueField)?i.valueField:"Figure";a.esMapDataSource=e.getTreeMapDS(a.esPqDef,!0,f,g,j),a.esMapOptions={};var k=a.esMapOptions,l={type:i.type&&angular.isString(i.type)?i.type:"marker",dataSource:a.esMapDataSource,locationField:"latlng",titleField:i.titleField&&angular.isString(i.titleField)?i.titleField:"esLabel",autoBind:angular.isUndefined(i.autoBind)?!1:!!i.autoBind,valueField:j};"bubble"==l.type&&(k.shapeMouseEnter=function(b){a.bubbleMessage=b.shape.dataItem[l.titleField]+" - "+b.shape.dataItem[l.valueField].toString(),b.shape.options.set("stroke",{width:2,color:"#00f"}),a.$apply()},k.shapeMouseLeave=function(b){a.bubbleMessage="",b.shape.options.set("stroke",null),a.$apply()},l.style={fill:{color:i.color&&angular.isString(i.color)?i.color:"#00F"},stroke:{width:1}}),k.layers=[{type:"tile",urlTemplate:"https://#= subdomain #.tile.openstreetmap.org/#= zoom #/#= x #/#= y #.png",subdomains:["a","b","c"],attribution:"&copy; <a href='http://osm.org/copyright'>OpenStreetMap contributors</a>.Tiles courtesy of <a href='http://www.openstreemap.org/'>Entersoft SA</a>"},l],a.executePQ=function(){a.esPanelOpen.status=!1,a.esMapDataSource&&a.esMapDataSource.read()},a.esPqDef.runPQ=a.executePQ,a.$on("$destroy",function(){angular.element(b).unbind("resize",h)}),angular.element(b).bind("resize",h)}}}]).directive("esLocalGrid",["$log","esWebApi","esMessaging","esUIHelper","esGlobals",function(a,b,c,d,e){return{restrict:"AE",scope:{esGridOptions:"=",esDataSource:"="},templateUrl:function(a,b){return"src/partials/esLocalGrid.html"},link:function(a,b,c){a.esGridRun=function(){a.esGridCtrl&&a.esGridCtrl.dataSource.read()}}}}]).directive("es00DocumentsDetail",["$log","$uibModal","esWebApi","esUIHelper","esGlobals","esCache",function(a,b,c,d,e,f){return{restrict:"AE",scope:{esDocumentGridOptions:"=?",esMasterRowField:"=?",esIsudgid:"=?"},template:"<div ng-include src=\"'src/partials/es00DocumentsDetail.html'\"></div>",link:function(b,g,h){function i(a,f,g,h){var i=a,j=d.winGridInfoToESGridInfo(g,h,i),k=new e.ESPQOptions(1,-1,!0,!1);a=d.esGridInfoToKInfo(g,h,{},j,k),a.autoBind=!0,a.toolbar=null,a.groupable=!1,a.dataSource=f;var l=_.find(j.columns,{field:"Code"});if(l){var m=c.downloadURLForBlobDataDownload("{{dataItem.GID}}");l.template="<a ng-href='"+m+"' download>{{dataItem.Code}}</a>"}b.esDocumentGridOptions=angular.extend(a,b.esDocumentGridOptions)}b.$watch("esIsudgid",function(a,c){b.esDocumentGridOptions&&b.esDocumentGridOptions.dataSource&&b.esDocumentGridOptions.dataSource.read()}),b.esIsudgid||h.esIsudgid||b.esMasterRowField||h.esMasterRowField||(b.esMasterRowField="GID",a.warn("esIsudgid is not specified and esMasterRowField for es00DocumentsDetail directive NOT specified. Assuming GID"));var j=function(){var a="ES00Documents",d="ES00DocumentsDetails",e={serverGrouping:!1,serverSorting:!1,serverFiltering:!1,serverPaging:!1,pageSize:20,transport:{read:function(a){try{var d=b.esIsudgid?b.esIsudgid:b.$parent.dataItem[b.esMasterRowField];c.fetchES00DocumentsByEntityGID(d).then(function(b){a.success(b)})["catch"](function(b){a.error(b)})}catch(e){a.success({data:[]})}}},schema:{data:"data",total:"data.length"}},g=new kendo.data.DataSource(e),h=f.getItem("PQI_"+a+"/"+d);h?i(h,g,a,d):c.fetchPublicQueryInfo(a,d,!0,!0).then(function(b){f.setItem("PQI_"+a+"/"+d,b.data),i(b.data,g,a,d)})["catch"](angular.noop)};j()}}}]).controller("esModalInvestigateCtrl",["$scope","$uibModalInstance","esMessaging","invParams",function(a,b,c,d){a.investigateGridOptions={autoBind:!0,selectable:d.paramDef.multiValued?"multiple, row":"row"},a.invParams=d||{},a.selectedRows=null;var e=function(b,c){return c&&0!=c.length?void(a.selectedRows=_.map(c,function(c){return b.sender.dataItem(c)[a.invParams.esConnect]})):void(a.selectedRows=null)};b.closed.then(function(){c.unsubscribe(f)})["catch"](angular.noop);var f=c.subscribe("GRID_ROW_CHANGE",e);a.ok=function(){b.close(a.selectedRows)},a.cancel=function(){b.dismiss("cancel")}}]).controller("esAdvancedParamCtrl",["$uibModalInstance","inAdvancedParam",function(a,b){var c=this;c.editedParam=b,c.ok=function(){a.close(c.editedParam)}}]).controller("esAskForFieldCtrl",["$uibModalInstance","inDef",function(a,b){var c=this;c.inDef=b,c.ok=function(){a.close(!0)},c.cancel=function(){a.dismiss("cancel")}}]).controller("esChangePasswordCtrl",["$uibModalInstance","inDef",function(a,b){var c=this;c.inDef=b,c.ok=function(){a.close(c.inDef)},c.cancel=function(){a.dismiss("cancel")}}]).directive("esParam",["$log","$uibModal","esWebApi","esUIHelper","esGlobals",function(a,b,c,d,e){return{restrict:"AE",scope:{esParamDef:"=",esParamVal:"=",esType:"="},template:"<div ng-include src=\"'src/partials/'+esType+'.html'\"></div>",link:function(a,f,g){if(!a.esParamDef)throw"You must set a param";a.drStatus={dateOpen:!1},a.askForMore=function(c){var d="esAdvancedModal"+c.toUpperCase()+".html",f=b.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",template:"<div ng-include src=\"'src/partials/"+d+"'\"></div>",controller:"esAdvancedParamCtrl",controllerAs:"$ctrl",size:"sm",appendTo:null,resolve:{inAdvancedParam:function(){return{esParamDef:a.esParamDef,esParamVal:a.esParamVal,esGlobals:e}}}});f.result.then(function(a){})["catch"](angular.noop)},a.onClose=function(b,c){if(b&&b.sender){var d=b.sender.value();c?("NULL"==d||"NOTNULL"==d)&&(a.drStatus.dateOpen=!1):"0"!=d&&"1"!=d&&(a.drStatus.dateOpen=!1)}},a.esParamDef.isInvestigateEntity()&&(a.onInvestigate=function(){var c=b.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",template:"<div ng-include src=\"'src/partials/esInvestigate.html'\"></div>",controller:"esModalInvestigateCtrl",size:"lg",resolve:{invParams:function(){var b=a.esParamVal[a.esParamDef.id].clone("Code"),c="",d="",f="",g=a.esParamDef.getTag("INVPQ:").split("INVPQ:");return g.length>=2&&(g=g[1].split("\\"),g.length>=3&&(c=g[0],d=g[1],f=g[2])),{paramDef:a.esParamDef,esGroup:c,esFilter:d,esConnect:f,pVals:new e.ESParamValues([b])}}}});c.result.then(function(b){if(b&&0!=b.length){var c=_.join(b,"\\,");a.esParamVal[a.esParamDef.id].pValue(c)}})["catch"](angular.noop)}),a.esGlobals=e,a.esWebUIHelper=d,a.esWebApiService=c,a.esParamDef.isInvestigateZoom()&&(a.esParamLookupDS=d.getZoomDataSource(a.esParamDef.invSelectedMasterTable)),(6==a.esParamDef.controlType||20==a.esParamDef.controlType)&&(a.dateRangeOptions=e.getesDateRangeOptions(a.esParamDef.controlType))}}}]).directive("esWebPq",["$log","esWebApi","esUIHelper","esMessaging","esGlobals","esCache",function(a,b,c,d,e,f){return{restrict:"AE",scope:{esGroupId:"=",esFilterId:"=",esGridOptions:"=?",esForceTitle:"=?",esParamsValues:"=",esPanelOpen:"=?",esPqDef:"=?",esPQOptions:"=?",esShowTopPagination:"=",esPostProcessGridOptions:"&"},templateUrl:function(a,b){return"src/partials/esWebPQ.html"},link:function(a,d,g){function h(){a.esPqDef&&a.esPqDef.isDonePromise&&a.esPqDef.isDonePromise.resolve(a.esPqDef)}function i(b){var d=c.winGridInfoToESGridInfo(a.esGroupId,a.esFilterId,b);a.esParamsValues&&a.esParamsValues instanceof e.ESParamValues?a.esParamsValues.merge(d.defaultValues):a.esParamsValues=d.defaultValues,a.esParamsDef=d.params;var f=c.esGridInfoToKInfo(a.esGroupId,a.esFilterId,a.esParamsValues,d,a.esPQOptions,a.esPqDef),g=angular.extend(f,a.esGridOptions);if(a.esPostProcessGridOptions&&angular.isFunction(a.esPostProcessGridOptions)&&(g=a.esPostProcessGridOptions({arg1:g})||g),g&&g.esToolbars&&angular.isArray(g.esToolbars)){var i=g.toolbar||[];_.forEach(g.esToolbars,function(a){i.push({template:a.template})})}a.esGridOptions=g,h()}if(!a.esGroupId||!a.esFilterId)throw"You must set the pair es-group-id and es-filter-id attrs";a.executePQ=function(){a.esPanelOpen.status=!1,a.esGridOptions.dataSource.read()},a.esPqDef&&(a.esPqDef.runPQ=a.executePQ,a.esPqDef.ParametersDefinition=function(){return a.esParamsDef});var j=f.getItem("PQI_"+a.esGroupId+"/"+a.esFilterId);j?i(j):b.fetchPublicQueryInfo(a.esGroupId,a.esFilterId,!0,!0).then(function(b){f.setItem("PQI_"+a.esGroupId+"/"+a.esFilterId,b.data),i(b.data)})["catch"](angular.noop)}}}]).directive("esParamsPanel",["$translate","$log","esWebApi","esUIHelper","esGlobals",function(a,b,c,d,e){return{restrict:"AE",scope:{esPanelOpen:"=?",esParamsDef:"=?",esPqInfo:"=?",esParamsValues:"=?",esGroupId:"=?",esFilterId:"=?",esRunClick:"&",esForceTitle:"=?",esRunTitle:"@?",esShowRun:"=?",esLocalDataSource:"=?",esDataSource:"=?"},templateUrl:function(a,b){return"src/partials/esParams.html"},link:function(b,f,g){b.esMore=!1,b.esToggleMore=function(){b.esMore=!b.esMore};var h=function(){b.esGroupId instanceof e.ESPublicQueryDef&&b.esGroupId.isDonePromise&&b.esGroupId.isDonePromise.resolve(b.esGroupId)};if(b.esPanelOpen||(b.esPanelOpen={status:!1}),!g.esParamsDef&&!g.esPqInfo&&!(b.esGroupId instanceof e.ESPublicQueryDef||b.esGroupId&&b.esFilterId))throw new Error("You must set either the es-params-def or es-pq-info or the pair es-group-id and es-filter-id attrs");b.esShowRun&&!b.esRunTitle&&a("ESUI.PQ.PARAMS_PANEL_RUN").then(function(a){b.esRunTitle=a})["catch"](angular.noop),b.esGroupId instanceof e.ESPublicQueryDef&&!g.esParamsValues&&(b.esParamsValues=b.esGroupId.Params,b.esGroupId.ParametersDefinition=function(){return b.esParamsDef}),g.esParamsDef?h():g.esPqInfo?(b.esParamsDef=esPqInfo.params,h()):c.fetchPublicQueryInfo(b.esGroupId,b.esFilterId,!0,!0).then(function(a){var c=d.winGridInfoToESGridInfo(b.esGroupId,b.esFilterId,a.data);if(b.esGroupId instanceof e.ESPublicQueryDef)if(b.esLocalDataSource)b.esGroupId.esGridOptions=d.esGridInfoToLocalKInfo(b.esGroupId.GroupID,b.esGroupId.FilterID,b.esGroupId.Params,c,b.esDataSource,b.esGroupId);else{var f=new e.ESPQOptions(1,-1,!0,!1);b.esGroupId.esGridOptions=d.esGridInfoToKInfo(b.esGroupId.GroupID,b.esGroupId.FilterID,b.esGroupId.Params,c,f,b.esGroupId)}b.esParamsValues&&b.esParamsValues instanceof e.ESParamValues?b.esParamsValues.merge(c.defaultValues):b.esParamsValues=c.defaultValues,b.esParamsDef=c.params,h()})["catch"](angular.noop)}}}]),esWEBUI.factory("esUIHelper",["$state","$translate","$log","$timeout","esMessaging","esWebApi","esGlobals",function($state,$translate,$log,$timeout,esMessaging,esWebApiService,esGlobals){function esColToKCol(a,b,c){var d={field:a.field,title:a.title,width:a.width,attributes:a.attributes,columnSet:a.columnSet,values:a.enumValues,dataType:a.dataType,hidden:!a.visible,headerAttributes:{"class":"es-table-header-cell"},menu:!!a.title,template:void 0,footerTemplate:void 0,aggregate:void 0,groupFooterTemplate:void 0};switch((!c||c.totalRow)&&(d.aggregate=a.aggregate),a.dataType){case"int32":case"byte":"8"==a.editType&&(d.template=kendo.format('<div align="center"><input type="checkbox" #={0} ? "checked=checked" : "" # disabled="disabled" ></input></div>',a.field));break;case"byte[]":"0"==a.editType&&(d.template="<img src='#:kendo.format('data:image/jpg;base64,{0}', "+a.field+")#'/>");break;case"string":var e=!1;if(b&&b.showCol==a.field&&b.selectedMasterField&&b.selectedState&&$state){var f=$state.get(),g=_.find(f,{name:b.selectedState});if(g){var h=kendo.format("#= ((data.{0}) && (data.{1})) ? ",b.selectedMasterField,a.field),i='kendo.format("<a ui-sref=\\"{2}({PK: \'{0}\'} )\\">{1}</a>", '+b.selectedMasterField+", "+a.field+", '"+b.selectedState+"')";d.template=h+i+kendo.format(" : (data.{0}) #",a.field),e=!0}else if(b.selectedState&&"es00documents"==b.selectedState.toLowerCase()){var j=esWebApiService.downloadURLForBlobDataDownload("{{dataItem.GID}}");d.template="<a ng-href='"+j+"' download>{{dataItem.Code}}</a>"}}if(!e){var k="";-1!=a.field.toLowerCase().indexOf("email")?k="mailto:":-1!=a.field.toLowerCase().indexOf("tele")||-1!=a.field.toLowerCase().indexOf("mobile")?k="tel:":-1!=a.field.toLowerCase().indexOf("website")?d.template=kendo.format("<a target='_blank' href='#={0}||''#'>#={0}||''#</a>",a.field):-1!=a.field.toLowerCase().indexOf("eswebimage")&&(d.template=kendo.format("<a target='_blank' href='#={0}#.jpeg'><img src='#={0}#.jpeg' height='{1}' width='{1}'></a>",a.field,a.width)),k&&(d.template=kendo.format("<a target='_blank' href='{1}#={0}||''#'>#={0}||''#</a>",a.field,k))}break;case"datetime":var l=a.formatString||"d";d.format="{0:"+l+"}";break;default:a.formatString&&""!=a.formatString&&(d.format="{0:"+a.formatString+"}")}if(d.aggregate){d.aggregates=[d.aggregate];var m=a.formatString?"kendo.toString("+d.aggregate+",'"+a.formatString.replace(/#/g,"\\\\#")+"') || ''":d.aggregate;d.footerTemplate="<div style='text-align: right'>#:"+m+"#</div>",d.groupFooterTemplate=d.footerTemplate}return d}function handleChangeGridRow(a){var b=this.select(),c=void 0;if(b&&1==b.length&&(c=this.dataItem(b[0]).GID),c&&this.options.masterDetailRelations){if(!(this.options.masterDetailRelations instanceof ESRequeryDetailGrids))throw"masterDetailRelations should be of type ESRequeryDetailGrids";_.each(this.options.masterDetailRelations.registeredRelations,function(a){a instanceof ESMasterDetailGridRelation&&$timeout(function(){var b=a.detailParams(),d=a.detailDataSource();d&&b&&b[a.detailParamCode]&&b[a.detailParamCode].pValue(c)&&d.read()})})}esMessaging.publish("GRID_ROW_CHANGE",a,b)}function prepareStdZoom(a,b){var c={transport:{read:function(c){var d={};esWebApiService.fetchStdZoom(a,d,b).then(function(a){var b=a.data;-1==b.Count&&(b.Count=b.Rows?b.Rows.length:0),c.success(b)},function(a){c.error(a)})["catch"](angular.noop)}},schema:{data:"Rows",total:"Count"}};return new kendo.data.DataSource(c)}function processPQ(a){function b(a,c,d){var e=[],f="a"+d.toString();return _.forOwn(_.groupBy(a,function(a){return a[f]}),function(a,f){if("undefined"==f)return e;var g={};g.name=f,g.value=_.sumBy(a,function(a){return a.Figure}),c>d&&(g.items=b(a,c,d+1)),e.push(g)}),e}function c(a){var b,c=a.length;for(b=10;b>=1;b--){var d="a"+b.toString(),e=_.groupBy(a,function(a){return a[d]}),f=e.undefined;if(!angular.isArray(f)||f.length!=c)return b}return 0}var d={name:"All",value:0};if(!a||!angular.isArray(a)||!a.length)return[d];var e=c(a);return 0==e?[d]:(d.value=_.sumBy(a,function(a){return a.Figure})||0,d.items=b(a,e,1),[d])}function getTreeMapDS(a,b,c,d,e){var f=b?convertPQRowsToMapRows:processPQ,g=angular.isFunction(a)?a():a,h={transport:{read:function(a){var b={};b.WithCount=!1,b.Page=-1,b.PageSize=-1;var c=g.Params;if(c instanceof esGlobals.ESParamValues){if(!c.isValidState()){var d=new Error($translate.instant("ESUI.PQ.PARAMS_MISSING"));throw a.error(d),d}c=c.getExecuteVals()}esWebApiService.fetchPublicQuery(g.GroupID,g.FilterID,b,c).then(function(b){b=b.data,b.Rows=b.Rows||[];var c=f(b.Rows,e);a.success(c)})["catch"](function(b){a.error(b)})}},schema:{model:{children:"items"}}};return c&&angular.isFunction(c)&&(h.change=c),d&&angular.isFunction(d)&&(h.requestEnd=function(a){var b=d();b&&b.element&&b.element.parent()&&kendo.ui.progress(b.element.parent(),!1)},h.requestStart=function(a){var b=d();b&&b.element&&b.element.parent()&&kendo.ui.progress(b.element.parent(),!0)}),b?new kendo.data.DataSource(h):new kendo.data.HierarchicalDataSource(h)}function prepareWebScroller(a,b,c,d,e){var f=angular.isFunction(a)?a():a;d&&c&&_.map(d,function(a){a.aggregates=c});var g={aggregate:c,group:d,transport:{error:function(a){console.log(a)},read:function(a){var b={};a.data&&a.data.page&&a.data.pageSize&&(b.WithCount=!0,b.Page=a.data.page,b.PageSize=a.data.pageSize);var c=f.Params;if(c instanceof esGlobals.ESParamValues){if(!c.isValidState()){var d=new Error($translate.instant("ESUI.PQ.PARAMS_MISSING"));throw a.error(d),d}c=c.getExecuteVals()}esWebApiService.fetchPublicQuery(f.GroupID,f.FilterID,b,c).then(function(b){b=b.data,angular.isDefined(b.Rows)||(b.Rows=[],b.Count=0),angular.isDefined(b.Count)||(b.Count=-1),a.success(b)})["catch"](function(b){$log.error("Error in DataSource ",b),a.error(b)})}},schema:{data:"Rows",total:"Count"}};return e&&angular.isFunction(e)&&(g.requestEnd=function(a){var b=e();b&&b.element&&b.element.parent()&&kendo.ui.progress(b.element.parent(),!1)},g.requestStart=function(a){var b=e();b&&b.element&&b.element.parent()&&kendo.ui.progress(b.element.parent(),!0)}),f&&f.SchemaColumns&&f.SchemaColumns.length&&(g.schema.parse=function(a){return _.each(a.Rows,function(a){_.each(f.SchemaColumns,function(b){var c=b.field;a[c]&&"string"==typeof a[c]&&(a[c]=kendo.parseDate(a[c]))})}),a}),b&&angular.extend(g,b),new kendo.data.DataSource(g)}function getPivotDS(a,b,c,d){function e(a){switch(a){case"string":return"string";case"decimal":return"number";case"datetime":case"date":return"date";default:return"string"}}var f=c||{};return _.forEach(d.columns,function(a){var b=a.field.toLowerCase(),c=_.findIndex(f.fields,function(a){return a.dataField.toLowerCase()==b});-1==c&&f.fields.push({dataField:a.field})}),_.forEach(f.fields,function(a){if(a.dataField){var b=a.dataField.toLowerCase(),c=_.find(d.columns,function(a){return b==a.field.toLowerCase()});c&&(a.caption=a.caption||c.title,a.dataType=a.dataType||e(c.dataType),a.summaryType=a.summaryType||c.aggregate||("number"==a.dataType?"sum":"count"),a.format=a.format||getPivotColFormatType(c),angular.isDefined(a.groupInterval)&&"date"==a.dataType&&(delete a.caption,delete a.summaryType,delete a.format))}}),f.load=function(c){var d=a.defer();return esWebApiService.fetchPublicQuery(b).then(function(a){a=a.data,d.resolve(a.Rows||[])})["catch"](function(a){$log.error("Error in DataSource ",a),d.resolve([])}),d.promise},new DevExpress.data.PivotGridDataSource(f)}function esExportToExcel(a){for(var b=a.workbook.sheets[0],c=0;c<b.rows.length;c++){var d=b.rows[c].type;if("group-footer"==d||"footer"==d)for(var e=0;e<b.rows[c].cells.length;e++){var f=b.rows[c].cells[e];f.value&&(f.value=$(f.value).text(),f.hAlign="right",f.bold=!0)}}}function esGridInfoToLocalKInfo(a,b,c,d,e){var f={pageable:{refresh:!0,pageSizes:[20,50,100,1e3]},autoBind:!1,sortable:!0,scrollable:!0,selectable:"row",allowCopy:!0,resizable:!0,reorderable:!0,navigatable:!0,noRecords:{template:"<h3><span class='label label-info'>"+kendo.ui.Pager.prototype.options.messages.empty+"</span></h3>"},filterable:!0,groupable:!0,toolbar:["excel"],excel:{allPages:!0,fileName:a+"-"+b+".xlsx",proxyURL:esWebApiService.proxyExportSaveFile("telerik"),forceProxy:!0,filterable:!0},excelExport:esExportToExcel};return esGlobals.getESUISettings().mobile&&(f.mobile=esGlobals.getESUISettings().mobile),esGlobals.getESUISettings().defaultGridHeight&&(f.height=esGlobals.getESUISettings().defaultGridHeight),f.columns=d.columns,_.map(f.columns,function(a){a.columns?_.map(a.columns,function(a){a.footerTemplate=void 0,a.groupFooterTemplate=void 0}):(a.footerTemplate=void 0,a.groupFooterTemplate=void 0)}),f.selectedMasterField=d.selectedMasterField,f.selectedMasterTable=d.selectedMasterTable,f.columnMenu=!1,e&&(f.dataSource=e),f.reBind=0,f}function esGridInfoToKInfo(a,b,c,d,e,f){var g=e instanceof esGlobals.ESPQOptions?e:(new esGlobals.ESPQOptions).initFromObj(e),h={serverGrouping:!1,serverSorting:!1,serverFiltering:!1,serverAggregates:!1,serverPaging:g.ServerPaging,pageSize:g.getPageSizeForUI()},i=_.uniq(_.union([g.getPageSizeForUI()],[20,50,100,1e3])).sort(function(a,b){return a-b}),j={pageable:{pageSizes:i},autoBind:g.AutoExecute,sortable:!h.serverPaging,scrollable:!0,selectable:"row",allowCopy:!0,resizable:!0,reorderable:!0,navigatable:!0,noRecords:{template:"<h3><span class='label label-info'>"+kendo.ui.Pager.prototype.options.messages.empty+"</span></h3>"},filterable:!h.serverPaging&&d.FilterLineVisible,groupable:!h.serverPaging&&d.GroupByBoxVisible,toolbar:[{name:"run",text:"Run",template:"<a role='button' class='k-button k-button-icontext' ng-click=\"esGridRun()\"><span class='k-icon k-i-reload'/>{{'ESUI.PQ.PARAMS_PANEL_RUN' | translate}}</a>"},{name:"excel",text:"Excel"}],excel:{allPages:!0,proxyURL:esWebApiService.proxyExportSaveFile("telerik"),forceProxy:!0,fileName:a+"-"+b+".xlsx",filterable:!0},excelExport:esExportToExcel};esGlobals.getESUISettings().mobile&&(j.mobile=esGlobals.getESUISettings().mobile),esGlobals.getESUISettings().defaultGridHeight&&(j.height=esGlobals.getESUISettings().defaultGridHeight),j.groups=d.groups,j.columns=d.columns,j.selectedMasterField=d.selectedMasterField,j.selectedMasterTable=d.selectedMasterTable,j.columnMenu=!1;var k=_.flatMap(j.columns,function(a){return a.columns?_.filter(a.columns,function(a){return!!a.aggregate}):a.aggregate?[a]:[]});return j.dataSource=prepareWebScroller(function(){return{GroupID:a,FilterID:b,Params:c,SchemaColumns:_.filter(j.columns,{dataType:"datetime"})}},h,k,j.groups),f&&f.UIOptions&&f.UIOptions.detailDef&&(j.detailInit=detailInit,j.dataBound=function(){this.expandRow(this.tbody.find("tr.k-master-row").first())},j.detailDef=f.UIOptions.detailDef),j.reBind=0,j}function detailInit(a){console.log("detail init ");var b=this.options.detailDef;if(b){var c=a.data.ISUDGID||a.data.ISUDCODE;if(!c)return void console.log("No value in master row for GID or ISUDGID or ItemCode to query the details");var d=b.GroupID,e=b.FilterID,f=createESParams({ISUDGID:c}),g=b.PQOptions||(new esGlobals.ESPQOptions).initFromObj({ServerPaging:!1,WithCount:!0,AutoExecute:!0});esWebApiService.fetchPublicQueryInfo(d,e,!0,!0).then(function(b){var c=b.data,h=winGridInfoToESGridInfo(d,e,c),i=esGridInfoToKInfo(d,e,f,h,g);i.toolbar=i.toolbar.slice(1),$("<div/>").appendTo(a.detailCell).kendoGrid(i)})["catch"](angular.noop)}}function winColToESCol(a,b,c,d){var e,f;angular.isObject(a)?(f=a.GroupID,e=a.FilterID):(f=a,e=b);var g={AA:void 0,field:void 0,title:void 0,width:void 0,visible:void 0,attributes:void 0,enumValues:void 0,formatString:void 0,odsTag:void 0,dataType:void 0,editType:void 0,columnSet:void 0,aggregate:void 0};switch(g.AA=parseInt(d.AA),g.field=d.ColName,g.title=d.Caption,
g.odsTag=d.ODSTag,g.columnSet=parseInt(d.ColumnSet),g.dataType=d.DataTypeName?d.DataTypeName.toLowerCase():void 0,g.editType=d.EditType,g.width=parseInt(d.Width),d.AggregateFunction){case"1":g.aggregate="count";break;case"2":g.aggregate="sum";break;case"3":g.aggregate="average";break;case"4":g.aggregate="min";break;case"5":g.aggregate="max"}g.formatString=d.FormatString,g.visible="true"==d.Visible;var h=g.dataType;switch(g.dataType){case"byte":8==g.editType&&(h="boolean-checkbox")}if(g.attributes={"class":"es-grid-cell-"+h},"3"==d.TextAlignment&&(g.attributes.style="text-align: right;"),"decimal"===h&&(g.attributes.style=(g.attributes.style||"")+" # if("+g.field+" < 0) { #color:red;# } # "),"5"==d.EditType){var i=_.sortBy(_.filter(c.ValueList,function(a){var b=a.ColName==d.ColName;return b=b&&"undefined"!=typeof a.Value,b=b&&a.fFilterID.toLowerCase()==e}),function(a){return isNaN(a.Value)?null:parseInt(a.Value)}),j=_.map(i,function(a){return{text:a.Caption,value:isNaN(a.Value)?null:parseInt(a.Value)}});j&&j.length&&(g.enumValues=j)}return g}function esEval(pInfo,expr){var EQ={oper:"EQ",paramID:pInfo.id},GE={oper:"GE",paramID:pInfo.id},GT={oper:"GT",paramID:pInfo.id},LE={oper:"LE",paramID:pInfo.id},LT={oper:"LT",paramID:pInfo.id},NE={oper:"NE",paramID:pInfo.id},RANGE={oper:"RANGE",paramID:pInfo.id},NULL={oper:"NULL",paramID:pInfo.id},NOTNULL={oper:"NOTNULL",paramID:pInfo.id};return eval(expr)}function ESNumeric(a,b,c){b&&angular.isString(b)&&(b=b.replace(".","").replace(",",".")),c&&angular.isString(c)&&(c=b.replace(".","").replace(",","."));var d={value:isNaN(b)?null:new Number(b).valueOf(),valueTo:isNaN(c)?null:new Number(c).valueOf(),oper:a.oper||"EQ"};return new esGlobals.ESNumericParamVal(a.paramID,d)}function ESString(a,b,c){var d={value:b,valueTo:c,oper:a.oper||"EQ"};return new esGlobals.ESStringParamVal(a.paramID,d)}function createEsParamVal(a){if(!a||!a.id)return null;var b=a.value||[];b=angular.isArray(b)?b:[b];var c=new ESParamInfo;return angular.merge(c,a),b=_.map(b,function(a){return{Value:a}}),getEsParamVal(c,b)}function createESParams(a){if(!a)return new esGlobals.ESParamValues;var b=[];if(angular.isArray(a))_.map(a,function(a){var c=createEsParamVal(a);c&&b.push(c)});else{if(a instanceof esGlobals.ESParamValues){var c=new esGlobals.ESParamValues;return c.merge(a),c}for(var d in a){var e=a[d],f=createEsParamVal({id:d,value:e});f&&b.push(f)}}return new esGlobals.ESParamValues(b)}function ESParamInfo(a){this.id=a?a.id:void 0,this.aa=a?a.aa:void 0,this.caption=a?a.caption:void 0,this.toolTip=a?a.toolTip:void 0,this.controlType=a?a.controlType:void 0,this.parameterType=a&&a.parameterType?a.parameterType:"",this.precision=a?a.precision:void 0,this.multiValued=a?a.multiValued:!1,this.visible=a?a.visible:void 0,this.required=a?a.required:void 0,this.oDSTag=a?a.oDSTag:void 0,this.formatString=a?a.formatString:void 0,this.tags=a?a.tags:void 0,this.visibility=a?a.visibility:void 0,this.invQueryID=a?a.invQueryID:void 0,this.invSelectedMasterTable=a?a.invSelectedMasterTable:void 0,this.invSelectedMasterField=a?a.invSelectedMasterField:void 0,this.invTableMappings=a?a.invTableMappings:void 0,this.enumOptionAll=a?a.enumOptionAll:void 0,this.enumList=a?a.enumList:void 0,this.defaultValues=a?getEsParamVal(this,a.defaultValues):void 0,this.inputType=a&&a.inputType?a.inputType:""}function getEsParamVal(a,b){var c=a.parameterType.toLowerCase();if(0==c.indexOf("entersoft.framework.platform.esnumeric"))return b&&0!=b.length?esEval(a,b[0].Value).required(a.required):new esGlobals.ESNumericParamVal(a.id,{oper:"EQ",value:0}).required(a.required);if(0==c.indexOf("system.int32, mscorlib")&&7==a.controlType){var d=0;return b&&b.length>0&&(d=parseInt(b[0].Value)),new esGlobals.ESBoolParamVal(a.id,!!d).required(a.required)}if(0==c.indexOf("entersoft.framework.platform.esdaterange, queryprocess"))return b&&0!=b.length?new esGlobals.ESDateParamVal(a.id,b[0].Value).required(a.required):new esGlobals.ESDateParamVal(a.id,6==a.controlType?null:{dRange:"ESDateRange(FiscalPeriod)",fromD:null,toD:null}).required(a.required);if(0==c.indexOf("entersoft.framework.platform.esstring, queryprocess"))return b&&0!=b.length?esEval(a,b[0].Value).required(a.required):new esGlobals.ESStringParamVal(a.id,{oper:"EQ",value:null}).required(a.required);if(!b||0==b.length){var e=a.multiValued?[]:null;return new esGlobals.ESParamVal(a.id,e,a.enumList).required(a.required)}var f=_.map(b,function(b){return processStrToken(a,b.Value)});return 1==f.length&&(f=f[0]),new esGlobals.ESParamVal(a.id,f,a.enumList).required(a.required)}function processStrToken(a,b){if(!a)return b;var c=a.parameterType.toLowerCase();if(-1!=c.indexOf("system.byte")||-1!=c.indexOf("system.int"))return parseInt(b);if(a.enumList&&a.enumList.length>1)return b;if(!_.startsWith(b,"##("))return"system.datetime, mscorlib"==c?new Date(b).toISOString():b;switch(b.toLowerCase()){case"##(esbranch)":var d=esGlobals.getClientSession();return d&&d.connectionModel?d.connectionModel.BranchID:b;default:return b}}function ESParamsDefinitions(a,b){this.title=a,this.definitions=b,this.paramsValues=null}function winParamInfoToesParamInfo(a,b){if(!a)return null;var c=new ESParamInfo;c.id=a.ID,c.aa=parseInt(a.AA),c.caption=a.Caption,c.toolTip=a.Tooltip,c.controlType=parseInt(a.ControlType),c.parameterType=a.ParameterType,c.precision=parseInt(a.Precision),c.multiValued="true"==a.MultiValued,c.visible="true"==a.Visible,c.required="true"==a.Required,c.oDSTag=a.ODSTag,c.tags=a.Tags?a.Tags.split("[(,)]"):"",c.visibility=parseInt(a.Visibility),c.invQueryID=a.InvQueryID,c.invSelectedMasterTable=a.InvSelectedMasterTable,c.invSelectedMasterField=a.InvSelectedMasterField,c.invTableMappings=a.InvTableMappings,c.enumOptionAll=a.EnumOptionAll;var d=_.map(_.filter(b.EnumItem,function(a){return a.fParamID==c.id&&"undefined"!=typeof a.ID}),function(a){return{text:c.oDSTag?a.Caption.substring(a.Caption.indexOf(".")+1):a.Caption,value:a.ID}});c.enumList=d.length?d:void 0;var e=b.DefaultValue;if(e&&angular.isArray(e)){var f=_.filter(e,{fParamID:c.id});c.defaultValues=getEsParamVal(c,f)}else c.defaultValues=getEsParamVal(c,[]);return c}function winGridInfoToESGridInfo(a,b,c){if(!c||!c.LayoutColumn)return null;var d,e;angular.isObject(a)?(e=a.GroupID,d=a.FilterID):(e=a,d=b);var f=d.toLowerCase(),g=_.filter(c.Filter,function(a){return a.ID.toLowerCase()==f});if(!g||1!=g.length)return null;var h={id:void 0,caption:void 0,rootTable:void 0,selectedMasterTable:void 0,selectedMasterField:void 0,columnSets:void 0,columns:void 0,params:void 0,defaultValues:void 0,groups:void 0,totalRow:!1};h.groups=_.map(_.filter(c.LayoutGroup,function(a){return a.fFilterID.toLowerCase()==f}),function(a){return{field:a.ColName,aa:a.AA,sortOrder:a.SortOrder}}),g=g[0],h.id=g.ID,h.caption=g.Caption,h.rootTable=g.RootTable,h.selectedMasterTable=g.SelectedMasterTable,h.selectedMasterField=g.SelectedMasterField,h.totalRow="0"!=g.TotalRow;var i=_.map(_.filter(c.LayoutColumn,function(a){return a.fFilterID.toLowerCase()==f&&"Guid"!=a.DataTypeName}),function(a){return winColToESCol(e,f,c,a)}),j=_.sortBy(i,function(a){return parseInt(a.AA)}),k=_.find(j,function(a){return a.visible&&"string"==a.dataType}),l=_.map(j,function(a){var b=k?{showCol:k.field,selectedMasterField:h.selectedMasterField,selectedState:(h.selectedMasterTable||"").toLowerCase()}:void 0;return esColToKCol(a,b,h)});h.columnSets=_.sortBy(_.map(_.filter(c.LayoutColumnSet,function(a){return a.fFilterID.toLowerCase()==f}),function(a){return{aa:parseInt(a.Position),title:a.Caption,columns:void 0}}),"aa"),h.columns=l,h.columnSets&&h.columnSets.length>0?(_.each(h.columnSets,function(a){a.columns=_.filter(l,{columnSet:a.aa}),l=_.difference(l,a.columns)}),h.columnSets=_.sortBy(_.filter(h.columnSets,function(a){return a.columns&&a.columns.length>0}),"aa"),l=h.columnSets.concat(l),h.columns=l):h.columns=l,h.params=new ESParamsDefinitions(h.caption,_.map(c.Param,function(a){return winParamInfoToesParamInfo(a,c)}));var m=_.map(h.params.definitions,function(a){return a.defaultValues});return h.defaultValues=new esGlobals.ESParamValues(m),h}return ESParamInfo.prototype.paramTemplate=function(){var a=this;if(!a||!a.parameterType)return"esParamText";var b=a.parameterType.toLowerCase();if(0==b.indexOf("system.int32, mscorlib"))switch(a.controlType){case 7:return"esParamBoolean";default:if(!a.enumList||!a.enumList.length)return"esParamNumeric"}if(0==b.indexOf("entersoft.framework.platform.esdaterange, queryprocess"))return"esParamDateRange";if(0==b.indexOf("entersoft.framework.platform.esnumeric"))return"esParamAdvancedNumeric";if(0==b.indexOf("entersoft.framework.platform.esstring, queryprocess"))return"esParamAdvancedString";if(0==b.indexOf("system.string, mscorlib"))switch(a.controlType){case 1:return"esParamNumeric";case 2:return"esParamNumeric"}return a.enumList&&a.enumList.length>1?a.multiValued||a.enumOptionAll?"esParamMultiEnum":"esParamEnum":a.isInvestigateZoom()?(a.invSelectedMasterField||(a.invSelectedMasterField="Code"),a.multiValued?"esParamMultiZoom":"esParamZoom"):a.isInvestigateEntity()?"esParamInv":"esParamText"},ESParamInfo.prototype.strVal=function(){return"Hello World esParaminfo"},ESParamInfo.prototype.isAdvanced=function(){return this.visible&&1==this.visibility},ESParamInfo.prototype.isInvestigateZoom=function(){return this.invSelectedMasterTable&&this.invSelectedMasterTable.length>4&&"Z"==this.invSelectedMasterTable[4]},ESParamInfo.prototype.getTag=function(a){if(!this.tags)return"";var b=_.find(this.tags,function(b){return b.startsWith(a)});return b},ESParamInfo.prototype.isInvestigateEntity=function(){return this.isInvestigateZoom()||!this.getTag("INVPQ:")?!1:!0},ESParamInfo.prototype.isDisplayedInHeader=function(){return this.tags&&this.getTag("TITLEPQ:")?!0:!1},ESParamsDefinitions.prototype.createDefinitions=function(a,b,c){if(this.title=a,!b||!angular.isArray(b))return this.definitions=[],this;this.definitions=_.map(b,function(a){var b;return c&&angular.isArray(c)&&(b=_.filter(c,{id:a.id})),new ESParamInfo(a,b)});var d=_.map(this.definitions,function(a){return a.defaultValues});return this.paramsValues=new esGlobals.ESParamValues(d),this},ESParamsDefinitions.prototype.getParamsValues=function(){return this.paramsValues},ESParamsDefinitions.prototype.visibleDefinitions=function(a){var b=this.definitions;return b?_.filter(b,function(b){return b.visible?a?!0:!b.isAdvanced():!1}):[]},ESParamsDefinitions.prototype.simpleDefinitions=function(){var a=this.definitions,b=a?_.filter(a,function(a){return a.visible&&1!=a.visibility}):[];return b},ESParamsDefinitions.prototype.advancedDefinitions=function(){var a=this.definitions;return a?_.filter(a,function(a){return a.isAdvanced()}):[]},ESParamsDefinitions.prototype.hasVisibleParams=function(){var a=this.definitions;return a?_.filter(a,function(a){return a.visible}).length>0:!1},ESParamsDefinitions.prototype.hasAdvancedParams=function(){this.definitions;return this.advancedDefinitions().length>=1},ESParamsDefinitions.prototype.strVal=function(a,b,c){if(!a||!this.definitions||0==this.definitions.length)return"";c=c||" / ";var d=_.filter(this.definitions,function(c){return c.visible&&a[c.id].strVal()&&(b?c.getTag("TITLEPQ:"):!0)}),e=_.reduce(_.sortBy(d,"aa"),function(b,d){return b+d.caption+": "+a[d.id].strVal()+c},"");return e.substring(0,e.lastIndexOf(c))},{ESRequeryDetailGrids:ESRequeryDetailGrids,ESMasterDetailGridRelation:ESMasterDetailGridRelation,winGridInfoToESGridInfo:winGridInfoToESGridInfo,winColToESCol:winColToESCol,esColToKCol:esColToKCol,esGridInfoToLocalKInfo:esGridInfoToLocalKInfo,esGridInfoToKInfo:esGridInfoToKInfo,getZoomDataSource:prepareStdZoom,getPQDataSource:prepareWebScroller,getTreeMapDS:getTreeMapDS,getPivotDS:getPivotDS,esResolveBlobUrl:esResolveBlobUrl,esResolveUserLogoUrl:esResolveUserLogoUrl,createEsParamVal:createEsParamVal,createESParams:createESParams,ESParamsDefinitions:ESParamsDefinitions,ESParamInfo:ESParamInfo,esAskForField:esAskForField,esChangePassword:esChangePassword,ESFavourites:ESFavourites,onMapClick:function(a,b,c){alert("A location has been clicked. Soon you will see a form here !!!")}}}])}();